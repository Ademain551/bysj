# 数据库清理和初始化说明

## 1. 执行 SQL 脚本清理数据库

请使用 MySQL 客户端执行以下 SQL 脚本：

```bash
# 方式1: 使用 MySQL 命令行
mysql -u root -p123456 bysj < springboot/src/main/resources/cleanup_and_init.sql

# 方式2: 在 MySQL Workbench 或其他客户端中执行
# 打开 springboot/src/main/resources/cleanup_and_init.sql 文件并执行
```

## 2. 或者手动执行以下步骤

### 步骤1: 删除多余的表

```sql
DROP TABLE IF EXISTS `admin`;
DROP TABLE IF EXISTS `disease_info`;
```

### 步骤2: 清空用户相关数据

```sql
DELETE FROM `user_friendships`;
DELETE FROM `chat_memberships`;
DELETE FROM `chat_messages`;
DELETE FROM `chat_rooms`;
DELETE FROM `detect_results`;
DELETE FROM `feedback`;
DELETE FROM `users`;
```

### 步骤3: 创建系统管理员账户

```sql
INSERT INTO `users` (`username`, `password_hash`, `created_at`, `nickname`, `email`, `avatar_url`, `enabled`, `role`, `user_type`) 
VALUES (
    'admin601', 
    '$2b$12$NnB7nUvkgX/uT1WsdHAdcuYyxmjjO2MKYJ5QcwwK3A7OMrnUaXjK2',  -- 88888888 的 BCrypt 哈希
    NOW(),
    '系统管理员',
    'admin601@example.com',
    NULL,
    1,
    'admin',
    'admin'
);
```

## 3. 登录信息

- **用户名**: admin601
- **密码**: 88888888
- **角色**: 系统管理员

## 4. 管理员功能

管理员登录后将看到以下功能模块：

1. **用户管理**: 增删改查用户信息
2. **病害管理**: 管理病害知识库
3. **病害分布**: 查看植物病害分布情况（bhxx表）
4. **识别记录**: 查看所有用户的识别记录
5. **公告管理**: 管理系统公告
6. **模型管理**: 检查模型状态、触发模型训练
7. **数据库管理**: 查看数据库表结构、清空表数据

## 5. 注意事项

- 系统管理员账户会在 Spring Boot 启动时自动创建/更新（通过 AdminInitializer）
- 如果数据库中没有 admin601 账户，系统会自动创建
- 管理员登录后会自动跳转到管理后台界面
- 普通用户登录后会跳转到首页

