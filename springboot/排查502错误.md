# 502 Bad Gateway 错误排查指南

## 问题描述
前端访问 `/api/detect/health` 时返回 502 错误。

## 可能的原因

### 1. Spring Boot 服务未启动（最常见）
**检查方法：**
```bash
# Windows PowerShell
netstat -ano | findstr :8099

# 或者直接访问
curl http://localhost:8099/api/detect/health
```

**解决方法：**
启动 Spring Boot 应用：
```bash
cd springboot
mvn spring-boot:run
# 或者运行打包后的 jar
java -jar target/mtjbysj-0.0.1-SNAPSHOT.jar
```

### 2. 数据库连接失败
**检查方法：**
查看 Spring Boot 启动日志，检查是否有数据库连接错误。

**解决方法：**
- 确保 MySQL 服务正在运行
- 检查 `application.properties` 中的数据库配置
- 确保数据库 `bysj` 已创建

### 3. FastAPI 服务未启动（不影响健康检查，但影响识别功能）
**检查方法：**
```bash
curl http://localhost:8001/health
```

**解决方法：**
```bash
cd pymodel
python api_server.py
```

## 修复内容

已修复健康检查端点逻辑：
- ✅ 即使 FastAPI 不可用，Spring Boot 也会返回 200 状态码
- ✅ 响应中包含 `fastapiAvailable` 字段，标识 FastAPI 服务状态
- ✅ Spring Boot 服务正常时始终返回 200

## 验证步骤

1. **检查 Spring Boot 是否运行：**
   ```bash
   curl http://localhost:8099/api/detect/health
   ```
   应该返回：
   ```json
   {
     "spring": "ok",
     "fastapiAvailable": false,
     "fastapi": "down"
   }
   ```

2. **检查前端代理配置：**
   确认 `vite.config.ts` 中的代理配置正确：
   ```typescript
   proxy: {
     '/api': {
       target: 'http://localhost:8099',
       changeOrigin: true,
     }
   }
   ```

3. **查看浏览器控制台：**
   检查完整的错误信息和响应内容

## 常见问题

### Q: 修改后仍然看到 502？
A: 需要重新编译并启动 Spring Boot 应用：
```bash
cd springboot
mvn clean package
mvn spring-boot:run
```

### Q: 前端代理不工作？
A: 检查：
1. Vite 开发服务器是否在运行
2. 端口是否正确（前端 5173，后端 8099）
3. 是否有防火墙阻止连接

