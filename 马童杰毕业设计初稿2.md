大理大学本科毕业设计

基于深度学习的农作物叶片病害诊断服务系统

——面向PlantVillage数据集的双任务识别模型与Web一体化平台

DEEP LEARNING-BASED CROP LEAF DISEASE DIAGNOSIS 

AND SERVICE SYSTEM

——DUAL-TASK RECOGNITION MODEL FOR THE PLANTVILLAGE DATASET WITH A WEB-INTEGRATED PLATFORM

学      院：     数学与计算机学院                      

学生  姓名：      马童杰                                     

学      号：      20221108900213                                     

指导  教师：       杨邓奇                                    

专      业：       计算机科学与技术                                    

年级（班级）：   2022级2班                            

起止  日期：    2025年 6 月— 2025年 12 月            

# 摘  要

随着智慧农业和数字乡村建设的推进，传统依赖人工经验和农技人员巡查的植物病害诊断方式在时效性、专业性和覆盖范围等方面逐渐暴露出局限性。为提高病害诊断效率、降低使用门槛、提升服务覆盖，本课题设计并实现了一套基于深度学习的植物病害识别与辅助决策系统。系统以公开的 PlantVillage 植物病害图像数据集为基础，结合轻量级卷积神经网络 MobileNetV2、FastAPI 推理服务以及 Spring Boot 后端和 Vue3 前端，实现了“图像识别 + 知识服务 + 技术指导 + 在线交易”的一体化 Web 平台。

在模型层面，本文首先对 PlantVillage 数据集进行清洗、划分与增强，通过过滤异常图像和合理的训练/验证/测试集划分，保证数据质量和评估客观性。针对实际场景中存在大量纯背景和无效图片的问题，本文构建了叶片存在性二分类模型，将无叶片背景与含叶片图像区分开来，并在推理阶段采用两阶段识别框架：先由叶片存在性模型进行背景拦截与提示，再由基于 MobileNetV2 的物种识别模型和病害识别模型分别完成作物种类与病害类型的预测。

在系统层面，本文采用前后端分离与模型服务解耦的总体架构。前端基于 Vue3 + TypeScript + Element Plus 构建单页应用，实现了登录注册、病害识别、识别历史、病害知识库、技术指导等功能；后端基于 Spring Boot 3 和 Spring Data JPA，负责用户与权限管理、识别记录管理、知识与技术指导管理、商品与订单管理等业务逻辑；模型推理服务基于 FastAPI 和 PyTorch 封装训练好的物种、病害和叶片存在性模型，对外提供统一的 /health 和 /predict 接口，并通过配置项与后端松耦合集成。

在测试与评估方面，本文从功能测试、识别模型评估和性能测试三个层面对系统进行验证。功能测试结果表明，系统能够支撑普通用户完成从图片上传、病害识别、知识查询、技术指导获取到农资购买和订单管理的完整业务流程；识别模型在 PlantVillage 测试集上取得了较为理想的分类性能，叶片存在性拦截策略在减少纯背景误诊方面发挥了积极作用；性能测试结果表明，在中等并发访问量下，识别接口和主要业务接口具有较为稳定的响应时间和资源占用。综合来看，本系统在功能完整性、识别准确性和系统可用性等方面基本达到了预期设计目标，为面向农户和种植户的植物病害智能诊断与辅助决策提供了一种可行方案。

关键词：植物病害识别；深度学习；MobileNetV2；FastAPI；Spring Boot；智慧农业

**Abstract**

With the rapid development of smart agriculture and digital countryside, traditional plant disease diagnosis methods that rely on farmers' experience and on-site inspection by agricultural technicians have gradually exposed limitations in timeliness, professionalism, and coverage. To improve diagnostic efficiency, lower the threshold for use, and expand service coverage, this thesis designs and implements a plant disease recognition and decision support system based on deep learning. Using the public PlantVillage dataset as the primary data source and combining the lightweight convolutional neural network MobileNetV2, a FastAPI-based inference service, a Spring Boot backend, and a Vue3 frontend, the system provides an integrated web platform that supports image-based disease recognition, knowledge services, technical guidance, and online transactions.

At the model level, the thesis first performs data cleaning, splitting, and augmentation on the PlantVillage dataset. By filtering abnormal images and adopting reasonable train/validation/test splits, data quality and evaluation objectivity are ensured. To address the large number of background or invalid images in real scenarios, a leaf presence binary classification model is constructed to distinguish background without leaves from leaf-containing images. A two-stage recognition framework is then adopted in inference: the leaf presence model first filters and warns about background images, and only images judged to contain leaves are further processed by MobileNetV2-based species and disease classifiers to predict crop species and disease types.

At the system level, a decoupled architecture with front–back separation and independent model services is adopted. The frontend is implemented as a Vue3 + TypeScript + Element Plus single-page application that provides functions such as user registration and login, disease recognition, history browsing, disease knowledge base, technical guidance, etc. The backend, built on Spring Boot 3 and Spring Data JPA, is responsible for user and role management, recognition record management, knowledge and guidance management, product and order management, etc. The model inference service is implemented using FastAPI and PyTorch, encapsulating species, disease, and leaf presence models, and exposing unified /health and /predict endpoints which are loosely integrated with the backend via configuration.

In terms of testing and evaluation, the system is verified from three aspects: functional testing, recognition model evaluation, and performance testing. Functional tests show that the system can support normal users to complete the end-to-end workflow from image upload, disease recognition, knowledge query, and technical guidance acquisition to agro-product purchase and order management. On the PlantVillage test set, the recognition models achieve satisfactory classification performance, and the leaf presence interception strategy effectively reduces misdiagnosis on pure background images. Performance tests indicate that, under moderate concurrent access, the recognition endpoints and major business endpoints maintain relatively stable response times and reasonable resource usage. Overall, the system meets the expected design goals in terms of functional completeness, recognition accuracy, and usability, and provides a feasible solution for intelligent plant disease diagnosis and decision support for farmers and growers.

**Key Words：**Plant disease recognition; deep learning; MobileNetV2; FastAPI; Spring Boot; smart agriculture

# 目  录

[摘  要	I](#_Toc216442681)

[目  录	V](#_Toc216442682)

[第一章 绪论	- 1 -](#_Toc216442683)

[1.1 研究背景与意义	- 1 -](#_Toc216442684)

[1.1.1 研究背景	- 1 -](#_Toc216442685)

[1.1.2 国内外研究现状	- 1 -](#_Toc216442686)

[1.1.3 研究意义	- 2 -](#_Toc216442687)

[1.2 课题研究内容与目标	- 2 -](#_Toc216442688)

[1.2.1 研究内容	- 2 -](#_Toc216442689)

[1.2.2 研究目标	- 2 -](#_Toc216442690)

[1.3 研究方法与技术路线	- 3 -](#_Toc216442691)

[1.3.1 研究方法	- 3 -](#_Toc216442692)

[1.3.2 技术路线	- 3 -](#_Toc216442693)

[1.4 论文结构安排	- 4 -](#_Toc216442694)

[第二章 系统需求分析	- 4 -](#_Toc216442695)

[2.1 需求获取	- 4 -](#_Toc216442696)

[2.1.1 业务需求	- 4 -](#_Toc216442697)

[2.1.2 功能需求	- 5 -](#_Toc216442698)

[2.1.3 典型业务场景	- 5 -](#_Toc216442699)

[2.2 非功能性需求	- 6 -](#_Toc216442700)

[2.2.1 性能需求	- 6 -](#_Toc216442701)

[2.2.2 可用性需求	- 6 -](#_Toc216442702)

[2.2.3 安全与可靠性需求	- 6 -](#_Toc216442703)

[2.3 标识参与者	- 6 -](#_Toc216442704)

[系统主要用户角色及其权限包括：	- 6 -](#_Toc216442705)

[2.3.1 普通用户（农户）	- 6 -](#_Toc216442706)

[通过前端使用系统核心功能的对象。可注册登录账号，上传叶片图片诊断病害，查看识别结果和历史记录，提交纠错反馈，浏览病害知识条目和技术指导文章，与专家用户添加好友并聊天咨询，挑选商品加入购物车、提交订单并支付，查看和管理自己的订单等。	- 6 -](#_Toc216442707)

[2.3.2 专家用户	- 6 -](#_Toc216442708)

[2.3.3 系统管理员	- 7 -](#_Toc216442709)

[2.4 标识用例	- 7 -](#_Toc216442710)

[2.4.1 普通用户用例	- 7 -](#_Toc216442711)

[2.4.2 专家用户用例	- 7 -](#_Toc216442712)

[2.4.3 管理员用例	- 7 -](#_Toc216442713)

[2.5 求精用例	- 8 -](#_Toc216442714)

[2.5.1 用例一：用户注册与登录	- 8 -](#_Toc216442715)

[**2.5.2 **用例二：上传植物叶片图片进行病害识别	- 8 -](#_Toc216442716)

[2.5.3 用例三：查看识别历史记录	- 9 -](#_Toc216442717)

[2.5.4 用例四：提交商品订单并完成支付	- 9 -](#_Toc216442718)

[2.5.5 用例五：管理员维护系统内容	- 10 -](#_Toc216442719)

[2.5.6 用例六：识别纠错与专家审核	- 11 -](#_Toc216442720)

[2.5.7 用例七：添加好友并发起聊天	- 11 -](#_Toc216442721)

[第三章 系统总体设计	- 12 -](#_Toc216442722)

[3.1 总体设计原则	- 12 -](#_Toc216442723)

[3.2 系统总体架构设计	- 13 -](#_Toc216442724)

[3.2.1 系统逻辑架构	- 13 -](#_Toc216442725)

[3.2.2 系统物理/部署架构	- 13 -](#_Toc216442726)

[3.3 功能模块划分	- 14 -](#_Toc216442727)

[3.3.1 前端模块设计	- 14 -](#_Toc216442728)

[3.3.2 后端业务模块设计（Spring Boot）	- 14 -](#_Toc216442729)

[3.3.3 识别模型服务模块设计（FastAPI）	- 14 -](#_Toc216442730)

[3.4 关键技术介绍	- 15 -](#_Toc216442731)

[3.4.1 前端关键技术	- 15 -](#_Toc216442732)

[3.4.2 后端关键技术	- 15 -](#_Toc216442733)

[3.4.3 识别模型与推理服务关键技术	- 15 -](#_Toc216442734)

[3.5 UML 设计	- 17 -](#_Toc216442735)

[3.5.1 系统包图	- 17 -](#_Toc216442736)

[3.5.2 核心类图	- 18 -](#_Toc216442737)

[3.5.3 典型时序图	- 19 -](#_Toc216442738)

[第四章 系统详细设计与实现	- 21 -](#_Toc216442739)

[4.1 数据集与数据预处理	- 21 -](#_Toc216442740)

[4.1.1 PlantVillage 数据集介绍	- 21 -](#_Toc216442741)

[4.1.2 数据清洗与质量过滤	- 21 -](#_Toc216442742)

[4.1.3 数据集划分策略	- 22 -](#_Toc216442743)

[4.1.4 数据增强策略	- 22 -](#_Toc216442744)

[4.2 识别模型总体设计	- 22 -](#_Toc216442745)

[4.2.1 任务定义与总体框架	- 22 -](#_Toc216442746)

[4.2.2 模型结构选择与对比	- 23 -](#_Toc216442747)

[4.3 模型结构与训练细节	- 23 -](#_Toc216442748)

[4.3.1 MobileNetV2 主干结构设计	- 23 -](#_Toc216442749)

[4.3.2 物种识别模型	- 24 -](#_Toc216442750)

[4.3.3 病害识别模型	- 24 -](#_Toc216442751)

[4.3.4 叶片存在性二分类模型	- 25 -](#_Toc216442752)

[4.3.5 训练超参数与优化策略	- 25 -](#_Toc216442753)

[4.4 模型训练流程实现	- 26 -](#_Toc216442754)

[4.4.1 主训练脚本设计	- 26 -](#_Toc216442755)

[4.4.2 叶片存在性模型训练与校准	- 27 -](#_Toc216442756)

[4.4.3 模型保存与加载策略	- 28 -](#_Toc216442757)

[4.5 模型推理服务设计与实现	- 29 -](#_Toc216442758)

[4.5.1 FastAPI 推理服务结构	- 29 -](#_Toc216442759)

[4.5.2 /predict 接口实现	- 29 -](#_Toc216442760)

[4.5.3 与后端的集成	- 31 -](#_Toc216442761)

[4.6 业务系统详细实现	- 31 -](#_Toc216442762)

[4.6.1 前端实现	- 31 -](#_Toc216442763)

[4.6.2 后端实现	- 32 -](#_Toc216442764)

[4.6.3 数据库设计	- 33 -](#_Toc216442765)

[第五章 系统测试与识别模型评估	- 33 -](#_Toc216442766)

[5.1 测试环境与工具	- 33 -](#_Toc216442767)

[5.2 测试方法与测试策略	- 33 -](#_Toc216442768)

[系统测试采用多种方法相结合的策略，从不同层次和角度对系统进行验证：	- 33 -](#_Toc216442769)

[5.2.1 黑盒测试与白盒测试	- 33 -](#_Toc216442770)

[5.2.2 单元测试、集成测试与系统测试	- 34 -](#_Toc216442771)

[5.2.3 回归测试策略	- 34 -](#_Toc216442772)

[5.3 功能测试	- 34 -](#_Toc216442773)

[5.3.1 功能模块测试用例设计	- 34 -](#_Toc216442774)

[5.3.2 测试用例表与执行结果记录	- 35 -](#_Toc216442775)

[5.4 识别模型测试与评估	- 35 -](#_Toc216442776)

[5.4.1 测试集性能指标	- 35 -](#_Toc216442777)

[5.4.2 混淆矩阵分析	- 35 -](#_Toc216442778)

[5.4.3 错误案例检查	- 36 -](#_Toc216442779)

[5.4.4 叶片存在性模型拦截效果	- 36 -](#_Toc216442780)

[5.5 性能测试	- 36 -](#_Toc216442781)

[5.5.1 模型推理接口并发测试	- 36 -](#_Toc216442782)

[5.5.2 主要业务接口并发测试	- 37 -](#_Toc216442783)

[5.5.3 系统资源监控	- 37 -](#_Toc216442784)

[5.6 测试结果分析与问题总结	- 37 -](#_Toc216442785)

[第六章 总结与展望	- 38 -](#_Toc216442786)

[6.1 工作总结	- 38 -](#_Toc216442787)

[6.2 创新点与特点	- 39 -](#_Toc216442788)

[6.3 存在的不足	- 40 -](#_Toc216442789)

[6.4 后续工作展望	- 40 -](#_Toc216442790)

# 第一章 绪论

## 1.1 研究背景与意义

### 1.1.1 研究背景

农业是国民经济的基础，粮食安全和农产品质量直接关系到国家的经济发展和社会稳定。然而，在农业生产过程中，各类植物病害广泛存在并频繁发生，严重影响作物的产量和品质。一方面，病害会导致叶片黄化、斑点、枯萎等症状，进而降低光合作用效率、削弱植株抗逆性，甚至引起大面积减产或绝收；另一方面，部分病害还会影响农产品外观和内在品质，降低商品价值，给农户和相关产业链带来较大经济损失。

随着新一代信息技术的迅猛发展，智慧农业、数字乡村、农业物联网等新理念不断涌现，大量传感器、无人机、智能手机等终端设备逐渐应用于农业生产一线。在这一背景下，如何利用计算机视觉和人工智能技术对作物病害进行自动识别和辅助诊断，成为农业信息化领域的重要研究方向。尤其是基于图像的病害识别方法，只需农户使用手机或相机拍摄作物叶片图片，即可在终端或云端完成自动分析，为农户提供直观、便捷的诊断建议，具有极高的应用潜力。

### 1.1.2 国内外研究现状

早期的植物病害图像识别研究多采用传统机器学习：通过人工提取病斑区域的颜色直方图、纹理特征、形状特征等，再利用 SVM、KNN、决策树等算法完成病害识别。这类方法在小规模、特定场景下可以取得一定效果，但人工特征表达能力有限，对光照、遮挡、拍摄角度等条件变化较为敏感，难以适应复杂多变的自然环境。

近年来，深度学习尤其卷积神经网络（CNN）的发展为图像识别领域带来突破。以 AlexNet、VGG、ResNet、DenseNet 等为代表的深层网络在大规模图像分类任务上取得了远超传统方法的性能。研究者开始将这些网络迁移到植物病害识别场景，通过在公共数据集或自建数据集上进行迁移学习和微调，大幅提升了病害识别的准确率和鲁棒性。例如，有研究使用 ResNet、Inception 等模型对 PlantVillage 数据集的病害进行分类，获得了很高的准确率；也有工作尝试结合目标检测或图像分割技术对病斑区域进行定位分析。总体而言，深度学习技术已成为当前植物病害图像识别的主流方法，显著改善了诊断效果。

### 1.1.3 研究意义

从应用层面来看，构建面向农户和种植户的植物病害识别与辅助决策系统，可大幅降低病害诊断的专业门槛。农户只需通过手机或电脑上传作物叶片照片，即可快速获得自动诊断结果和防治参考建议，不必完全依赖自身经验判断。同时，系统记录历史识别结果并与知识库联动，农户可以回溯不同时间、不同地块的病害发生情况，为制定施肥、防治、轮作等农业生产决策提供数据支撑。

这样的系统还能促进农业技术知识的传播和共享。通过集成病害知识库和技术指导模块，用户在获得诊断结果的同时可以进一步了解病害的背景知识和科学防治手段，提升其种植管理水平。此外，系统对接农资商品交易功能，为农户提供从诊断到购买农药肥料的一站式服务，形成业务闭环，提高生产效率。

## 1.2 课题研究内容与目标

### 1.2.1 研究内容

围绕植物病害智能诊断这一核心，本课题研究内容涵盖数据处理、模型构建、服务封装和业务系统集成等方面： - 数据与模型构建：清洗和增强 PlantVillage 图像数据，划分训练/验证/测试集；基于 MobileNetV2 迁移学习训练作物种类识别模型和病害类型识别模型，并训练叶片存在性检测模型，形成两阶段识别架构。 - 模型推理服务封装：利用 FastAPI 将训练好的 PyTorch 模型部署为独立推理服务，提供标准化 /health 和 /predict HTTP 接口。 - 业务系统开发与集成：基于 Spring Boot 开发后端业务逻辑，处理用户管理、识别请求（调用模型服务）、知识和指导内容管理、商品订单等，并与 FastAPI 推理服务通过 HTTP 解耦交互；基于 Vue3 开发前端界面，实现图片上传识别、结果展示、知识查询、技术指导查看、在线购物、消息交流等功能。 - 系统测试与优化：对整个系统进行功能测试、模型效果评估和性能测试，分析测试结果，发现问题并优化改进。 

### 1.2.2 研究目标

本课题的具体目标如下： 1. 构建高准确率的病害识别模型：在 PlantVillage 数据集上训练出能准确识别主要作物种类及其病害的深度学习模型，在测试集上达到较高精度，并通过叶片存在性检测减少背景图像误判。 2. 开发完整的诊断服务系统：设计实现包括前端、后端和模型服务的综合 Web 平台。前端界面友好、操作简便；后端功能完善、安全可靠；模型推理服务高效稳定，与后端松耦合集成。 3. 集成知识库和技术指导：构建病害知识库（病害概述、症状、防治措施等）和技术指导模块（专家撰写的防治方案、栽培管理建议等），与识别结果关联，使用户获取诊断结果的同时可查看相关知识和指导建议。 4. 实现农资交易闭环：在系统中集成农资商品展示、购物车、订单和支付功能。将诊断结果与农资商品推荐相结合，用户可直接购买所需药剂肥料，通过支付宝沙箱完成在线支付，形成“诊断-指导-购买”的闭环服务。 5. 验证系统性能与可用性：通过测试评估系统在实际使用场景下的功能正确性、响应速度和资源消耗。目标是在中等并发下识别接口和主要业务操作响应及时、系统运行稳定无重大错误。

## 1.3 研究方法与技术路线

### 1.3.1 研究方法

本课题采用理论研究与实践开发相结合的方法。首先通过文献调研掌握植物病害识别领域的研究现状和主流技术，并比较不同深度学习模型的特点，确定适合本课题的方案。随后以实际项目开发为主线，按照需求分析、系统设计、编码实现、测试优化的流程迭代开发系统。在开发过程中充分利用开源框架和工具（如 PyTorch、FastAPI、Spring Boot、Vue 等）快速实现原型，并根据实验反馈不断调整模型参数和系统功能。通过多轮实验测试验证模型效果和系统性能，根据测试结果迭代优化，从而将人工智能算法与软件工程实践相结合，确保系统技术先进性与实用性兼备。

### 1.3.2 技术路线

本课题技术路线可概括为“四个层次，逐级实现”： 1. 数据与模型构建：对 PlantVillage 数据集进行清洗和增强，划分数据集；基于 MobileNetV2 建立迁移学习模型训练物种分类和病害分类，并训练叶片存在性分类模型，确定背景拦截阈值。 2. 推理服务封装：使用 FastAPI 将训练好的模型封装为独立推理服务，提供标准 HTTP 接口；实现模型加载、请求处理和结果输出的逻辑。 3. 业务系统集成：后端通过配置模型服务URL（ml.fastapi.url）与 FastAPI 服务解耦交互；设计后端业务逻辑处理用户请求，包括调用模型服务、存储识别结果、查询知识条目和商品订单等，并确保接口安全控制和事务完整性。 4. 前端交互实现：采用 Vue3 + TypeScript 开发SPA前端，通过调用后端 API 实现用户注册登录、图片上传识别、结果展示、知识查询、技术指导查看、购物下单和聊天交流等功能，并通过 WebSocket 显示实时消息。

通过上述路线分层实现数据-模型-服务-应用的有机结合，为后续详细实现和测试奠定基础。 

## 1.4 论文结构安排

本文各章节安排如下：

第1章绪论，介绍课题背景与意义、相关研究现状，明确研究内容目标和方法路线，并说明论文结构；

第2章系统需求分析，从系统目标和用户角色出发，分析功能需求和非功能需求，给出用户角色划分和典型业务用例描述；

第3章系统总体设计，从总体架构、功能模块和关键技术等方面设计系统方案，包括逻辑架构、部署架构以及 UML 模型；

第4章系统详细设计与实现，重点介绍数据集处理、模型结构和训练实现、推理服务实现以及前端各模块、后端业务逻辑、数据库设计等具体内容；

第5章系统测试与评估，对系统进行功能测试、模型性能评估和性能测试并分析结果；

第6章总结与展望，总结课题工作和主要成果，指出系统存在的问题并提出未来改进方向。

# 第二章 系统需求分析

## 2.1 需求获取

### 2.1.1 业务需求

智慧农业和数字乡村背景下，一线农户迫切需要智能化的植物病害诊断与辅助决策工具。结合实际调研和项目定位，本系统旨在构建一个集“病害诊断、知识服务、技术指导、防治物品交易功能”于一体的综合性 Web 平台，帮助农户便捷获取病害诊断结果及相关服务。

### 2.1.2 功能需求

系统主要功能模块包括： 

植物病害识别：提供叶片图片上传与校验、调用模型识别作物种类及病害类型、返回置信度和 Top-K 候选结果、保存识别记录、支持历史查询和统计、生成识别报告等功能。 

知识库与技术指导：维护植物病害知识条目（病害分布、症状、防治方法等）和技术指导文章（专家发布的防治方案、栽培管理建议等），供用户按作物或病害类别浏览和搜索；支持文章评论、收藏等互动，以及识别结果与相关知识/文章的关联跳转。

 用户与权限管理：提供用户账号注册、登录和注销功能；用户可维护个人信息（昵称、联系方式、收货地址等）；系统采用角色区分普通用户、专家和管理员，不同角色具备不同功能权限（如专家能发布文章，管理员能管理所有内容）。 

购物与订单：展示农资商品信息（名称、类别、价格、库存、适用作物/病害等），用户可将商品加入购物车、下单创建订单，通过支付宝沙箱完成在线支付；提供订单列表和订单详情查询；管理员在后台可查看全站订单并处理订单状态。 

 聊天与消息：支持添加好友（通过账号/手机号搜索用户并建立好友关系）、私信聊天功能（即时发送和接收文本消息，消息持久化存储并支持历史记录查看）；同时实现系统通知推送（如订单状态更新、公告等）以消息形式提醒用户。 

公告与病害预警：管理员可发布系统公告，前端按时间顺序展示公告列表和详情；系统基于病害知识数据和天气等信息生成特定地区和时间的病害高风险预警提示，供用户参考。

### 2.1.3 典型业务场景

主要业务场景包括：用户上传作物叶片图片进行病害诊断并获得结果及防治建议；用户浏览病害知识库和技术指导文章学习相关知识；用户通过消息模块咨询专家获取指导；用户根据诊断推荐在线选购农资商品并完成订单支付；管理员在后台维护内容和监控系统运行等。

## 2.2 非功能性需求

### 2.2.1 性能需求

系统要求识别服务响应迅速、接口并发性能良好。通常情况下，模型推理应在数秒内返回结果；一般业务操作在百毫秒级返回。系统后端应支持一定并发用户访问（如同时几十个请求）而不明显降低响应速度。

### 2.2.2 可用性需求

系统界面需简洁友好，适合非专业用户使用，提供清晰的引导和提示；前端应兼容主流浏览器，保证在不同设备和分辨率下正常使用。系统应具有较高可用性，支持长时间不间断运行，关键服务（如模型推理）需提供健康检查和异常自动恢复机制，确保服务稳定。

### 2.2.3 安全与可靠性需求

系统应实现完善的访问控制和数据安全：通过基于角色的权限控制（RBAC）保障普通用户、专家、管理员各司其职，未授权用户无法访问敏感接口；支付流程中需确保交易请求和回调的签名验证，防止支付欺诈，保证订单数据一致性；后端应对模型服务的可用性进行监控，检测异常及时告警或切换；定期备份重要业务数据（用户、订单、识别记录等），日志集中记录系统运行和错误情况，支持审计和问题排查。

## 2.3 标识参与者

### 系统主要用户角色及其权限包括：

### 2.3.1 普通用户（农户）

### 通过前端使用系统核心功能的对象。可注册登录账号，上传叶片图片诊断病害，查看识别结果和历史记录，提交纠错反馈，浏览病害知识条目和技术指导文章，与专家用户添加好友并聊天咨询，挑选商品加入购物车、提交订单并支付，查看和管理自己的订单等。

### 2.3.2 专家用户

提供知识和技术服务的专业人员。可登录系统，在后台发布和维护技术指导文章、维护植物病害知识条目，浏览普通用户的识别记录来辅助诊断，处理用户提交的识别纠错反馈（确认模型识别是否正确，若错误提供正确结论），通过聊天模块与普通用户在线交流答疑等。

### 2.3.3 系统管理员

系统维护人员。可登录后台管理界面，管理用户和角色（如审核设置专家用户、封禁违规用户等）、维护病害知识和技术指导内容、维护商品信息、查看和管理所有用户的订单、配置系统参数（如支付接口密钥、模型服务地址等）、发布系统公告以及监控模型服务和系统整体运行状态等。

## 2.4 标识用例

### 2.4.1 普通用户用例

普通用户用例包括：账号注册与登录、修改个人信息和头像、上传叶片图片进行病害识别、查看识别结果和防治建议、浏览历史识别记录（以及删除自己的记录）、对识别结果提交纠错反馈、浏览植物病害知识库内容、阅读技术指导文章并发表评论或收藏、查看病害预警提示、查看系统公告、添加好友并发起聊天、浏览商品目录、将商品加入购物车或收藏、提交订单并支付、查看订单列表及详情等。

### 2.4.2 专家用户用例

专家用户用例包括：登录系统、发布和维护技术指导文章、维护病害知识条目、查看普通用户的识别记录并提供辅助诊断建议、查看并处理识别纠错反馈（确认模型识别是否正确或纠正错误识别）、通过聊天模块与普通用户（农户）进行在线交流和答疑等。

### 2.4.3 管理员用例

管理员用例包括：管理用户和角色（如审核专家资格、分配用户角色、禁用不良用户等）、维护病害知识和技术指导内容（增删改查知识条目和文章）、维护商品信息（新增/更新商品及库存等）、查看和管理订单（包括异常订单处理和确认收货等）、配置支付参数和模型服务地址等系统关键设置、发布和维护系统公告、监控模型服务健康状态和系统运行日志等。

## 2.5 求精用例

### 2.5.1 用例一：用户注册与登录

参与者：普通用户

前置条件：用户可正常访问系统登录/注册页面，系统运行状态稳定。

主事件流： 1）用户在注册页面填写符合格式要求的用户名、密码及个人基本信息，提交注册请求； 2）系统对用户名唯一性和字段格式进行校验，通过后在用户表中创建新的账户记录； 3）用户在登录页面输入用户名和密码，提交登录请求； 4）系统校验用户名是否存在、密码是否匹配，验证通过后创建会话，并在服务端记录登录状态； 5）前端根据登录状态更新本地存储信息，并将用户导航至首页或上次访问页面，展示相应功能入口。

备用事件流： 1）当用户名已存在或注册信息格式不符合要求时，系统返回明确的错误提示，用户根据提示修改后重新提交注册请求； 2）当登录阶段用户名不存在或密码错误时，系统返回登录失败信息，不建立会话，用户可重新输入凭证或找回密码； 3）当系统发生不可预期错误时，记录错误日志，并向用户返回通用的失败提示信息。

### **2.5.2 **用例二：上传植物叶片图片进行病害识别

参与者：普通用户

前置条件：用户已成功登录系统并进入识别页面；Spring Boot 后端与 FastAPI 模型服务均处于可用状态。

主事件流： 1）用户在识别页面选择本地叶片图片或通过终端设备拍照，并在界面中确认上传操作； 2）前端对待上传文件的类型和大小进行初步校验，通过后将图片文件随表单一并提交至后端识别接口； 3）后端在服务器本地创建唯一文件名，将图片保存到 uploads 目录，并构造请求调用 FastAPI 推理服务的预测接口； 4）FastAPI 完成叶片存在性判别及物种/病害双模型推理，返回包含物种名称、病害名称、置信度及 Top-K 候选列表的结构化结果； 5）后端解析推理结果，关联相应病害知识与防治物品信息，将识别结果、图片路径及防治建议等写入数据库； 6）前端接收并展示识别结果，同时提供跳转入口至病害知识详情、技术指导文章及推荐农资商品页面。

备用事件流： 1）若上传文件类型或大小不满足前端校验规则，则前端在本地阻止请求并给出提示；若前端未拦截但后端发现文件无效，则返回“文件格式不支持”等错误信息； 2）若调用 FastAPI 模型服务超时或返回异常，后端捕获异常并记录日志，同时向前端返回友好的错误提示，建议用户稍后重试或联系管理员； 3）若识别结果持久化至数据库过程中发生错误，系统记录详细错误信息，并提示用户识别结果暂未保存，以避免误导性呈现； 4）当模型判定图像为“背景无叶片”或疑似背景时，后端返回相应标记，前端引导用户重新拍摄更清晰的叶片图片。

### 2.5.3 用例三：查看识别历史记录

参与者：普通用户

前置条件：用户已登录系统，并至少完成过一次病害识别操作。

主事件流： 1）用户在系统导航菜单中选择“历史记录”功能入口； 2）前端根据当前登录用户身份，向后端请求该用户的识别记录列表，可携带分页参数和关键字查询条件； 3）后端按照识别时间倒序查询识别结果，封装成分页数据结构返回，包括预测类别、置信度、防治建议、识别时间及缩略图等； 4）前端以列表或卡片形式呈现历史记录，用户可点击某条记录查看识别详情； 5）在识别详情页面，用户可进一步跳转至相关病害知识、技术指导文章或生成识别报告等功能。

备用事件流： 1）当用户尚未进行过任何识别操作时，后端返回空列表，前端在历史记录页面显示“暂无识别记录”等提示信息； 2）当分页参数非法或查询条件异常时，后端采用合理默认值进行处理，并返回规范化的分页结果； 3）当用户请求删除单条或多条历史记录时，后端在校验记录归属后执行删除，同时清理关联纠错反馈，前端根据返回结果刷新列表。

### 2.5.4 用例四：提交商品订单并完成支付

参与者：普通用户

前置条件：用户已登录系统，购物车中存在至少一条待购买的农资商品记录，且支付宝沙箱支付环境配置正确。

主事件流： 1）用户在购物车页面核对商品名称、数量和单价，选择需要结算的条目，点击“结算”按钮； 2）前端将选中的购物车条目 ID 列表、数量等信息提交至后端订单结算接口； 3）后端校验购物车条目归属与有效性，计算各商品行小计和订单总金额，创建订单主表及订单明细记录，并标记订单状态为 CREATED； 4）用户在订单详情或支付页面点击“去支付”，前端调用后端支付接口，请求生成支付宝 PC 网页支付表单； 5）后端根据订单信息构造支付宝请求参数并发起跳转，用户在支付宝沙箱页面完成支付操作； 6）支付宝通过同步返回和异步回调接口通知系统支付结果，后端在验签通过后将订单状态更新为 PAID，前端在用户返回系统后展示支付结果和最新订单状态； 7）用户在收货后，可在订单详情页面发起“确认收货”操作，系统将订单状态更新为 COMPLETED。

备用事件流： 1）若购物车中不存在有效商品或计算得到的订单总金额小于等于零，后端返回错误信息，前端提示用户检查购物车内容； 2）支付过程中若用户主动取消支付或支付失败，订单状态保持为“未支付”，系统在订单列表中突出显示，用户可后续重新发起支付或取消订单； 3）在支付宝回调阶段，如验签失败或回调参数异常，系统拒绝更新订单状态，记录详细日志并提示管理员排查； 4）网络故障或第三方服务异常导致支付结果暂时不可确认时，系统在后续回调或人工干预后进行状态修正，并确保不会重复记账。

### 2.5.5 用例五：管理员维护系统内容

参与者：系统管理员

前置条件：管理员已通过后台登录认证，具备相应模块的管理权限。

主事件流： 1）管理员在后台管理界面中选择目标模块（如知识管理、技术指导管理、公告管理、商品管理、订单管理等）； 2）系统按指定筛选条件和分页参数从数据库中加载相应数据列表，并在界面中呈现； 3）管理员根据业务需求，对选定条目执行新增、编辑或删除操作，系统对关键字段进行合法性校验后持久化至数据库； 4）在订单管理模块中，管理员可查看订单详情、支付状态及物流信息，对异常订单进行标记和处理； 5）在系统设置模块中，管理员可配置或更新支付参数、模型服务访问地址等关键运行参数，并保存生效。

备用事件流： 1）当管理员权限不足以访问某一模块或执行某项操作时，系统拒绝请求并返回“权限不足”等提示信息； 2）当数据校验失败（如价格为负数、必填字段为空）时，系统阻止提交并在界面中标出错误字段； 3）当数据库或外部依赖暂时不可用时，系统记录错误日志并向管理员返回友好提示，避免造成数据不一致。

### 2.5.6 用例六：识别纠错与专家审核

参与者：普通用户、农林专家

前置条件：普通用户已登录系统，并在历史记录中存在至少一条识别结果；系统中已存在至少一名启用状态且用户类型为“专家”的账号。

主事件流： 1）普通用户在识别历史详情页发现模型识别结果可能有误，点击“识别有误/提交纠错”入口； 2）用户在弹出界面中选择目标专家，填写纠错说明（如实际观察到的症状及可能的病害），并提交反馈； 3）后端校验识别记录是否属于当前用户、专家账号是否存在且处于启用状态，校验通过后为该识别结果创建一条纠错反馈记录，初始状态为“待专家处理”； 4）专家登录系统，在“纠错任务”或“我的任务”页面按状态查看待处理反馈列表，选中某条记录进入详情； 5）专家综合查看原始识别结果、病害知识和用户提供的说明后，给出专业判断：

若确认模型识别结果正确，则填写补充说明并将反馈状态更新为“确认无误”；

若确认模型识别结果错误，则填写正确的植物名称和病害名称，系统基于映射关系生成新的模型类别标记，并将状态更新为“确认有误”，同时标记需要补充数据集与后续重训。 6）普通用户在“我的纠错反馈”列表中查看各条反馈的最新处理状态和专家回复内容。

备用事件流： 1）当识别记录不存在或不属于当前用户时，后端拒绝创建反馈并返回错误提示； 2）当所选专家账号不存在、未启用或其用户类型不是“专家”时，系统中止流程并提示用户重新选择专家； 3）对于已进入终态（如“确认无误”或“确认有误”）的反馈记录，系统禁止重复确认或修改，仅允许查看历史处理记录； 4）在记录映射模型类别时如无法根据植物名称和病害名称找到合法组合，系统提示专家调整填写内容或联系维护人员补充映射规则。

### 2.5.7 用例七：添加好友并发起聊天

参与者：普通用户

前置条件：发起方与目标用户均已在系统中完成注册并处于启用状态；即时通信与 WebSocket 服务运行正常。

主事件流： 1）用户在“添加好友”界面输入目标用户的账号或手机号，提交好友添加请求； 2）后端根据输入信息在用户表中查找目标用户，并校验目标用户存在且非当前登录用户； 3）若双方尚未建立好友关系，系统在好友关系表中创建一条新的双向好友记录；若已是好友，则跳过创建步骤； 4）系统调用聊天服务，为双方创建或复用一间私聊聊天室，并返回聊天室标识和对方用户的概要信息； 5）前端根据返回的聊天室标识跳转至聊天界面，请求该聊天室最近一段时间的消息列表，并按时间顺序展示； 6）用户在聊天输入框中编辑并发送文本消息，前端通过 REST 接口将消息内容和聊天室标识提交后端； 7）后端校验发送者是否为该聊天室成员，校验通过后持久化消息记录，并通过 WebSocket 将新消息实时推送给聊天室内的其他在线成员。

备用事件流： 1）当目标用户不存在、被禁用或输入信息为当前登录用户自身时，系统拒绝创建好友关系并给出相应提示； 2）在创建好友关系或聊天室过程中发生数据库异常时，系统中止操作并记录错误日志，对外仅返回通用失败信息； 3）当用户尝试在未加入的聊天室中发送、撤回或删除消息时，后端根据成员校验结果拒绝请求，并返回权限不足的提示； 4）当 WebSocket 连接异常或网络不稳定导致实时推送失败时，系统确保消息已持久化，前端在下一次拉取历史记录时仍可获取完整消息内容。

# 第三章 系统总体设计

## 3.1 总体设计原则

在明确课题背景和需求的基础上，本章从整体上设计系统架构和关键技术，遵循以下原则： 1. 结构清晰、分层合理：采用分层和模块化架构，将表示层、业务逻辑层、模型服务层、数据访问层相互分离。前端为SPA单页应用，后端采用Controller-Service-Repository三层结构，模型服务独立进程运行接口。清晰的层次划分提高系统可维护性和可扩展性。 2. 前后端分离、服务解耦：系统前端通过HTTP/HTTPS接口与后端交互，后端通过HTTP接口调用独立部署的FastAPI模型推理服务，实现业务服务与模型服务的松耦合。这种架构具有微服务特征，有利于后续模型服务独立扩展或上云。 3. 模型服务独立可升级：由于病害识别模型训练和推理在Python环境进行，业务系统在Java环境运行，为避免混用技术栈，系统采用后端业务服务+独立模型服务模式。后端只转发图片和处理结果，不直接依赖模型内部，实现两者通过配置（ml.fastapi.url）解耦。这样模型可独立更新升级，不影响业务系统运行。

## 3.2 系统总体架构设计

### 3.2.1 系统逻辑架构

从逻辑上系统分为前端表示层、后端业务逻辑层、识别模型服务层、数据持久化层： - 前端表示层：由Vue3 SPA构成，通过交互界面提供首页、识别、历史记录、知识库、技术指导、消息、购物车/订单、后台管理等页面，使用封装的API与后端通信，并利用路由和导航守卫控制页面访问权限和角色可见性。 - 后端业务逻辑层：基于Spring Boot，实现用户管理、识别记录管理、知识和指导内容管理、商品订单管理、支付集成、消息推送等业务逻辑，通过RESTful API和WebSocket对外提供服务。处理识别请求时负责接收前端上传图片、调用FastAPI模型服务得到结果并存储返回。 - 识别模型服务层：采用FastAPI框架，封装训练好的叶片存在性模型、物种识别模型和病害识别模型，提供标准HTTP接口（如/health,/predict）。后端通过HTTP请求调用该服务获取模型推理结果，实现与模型实现细节解耦。 - 数据持久化层：使用MySQL关系数据库存储用户、识别记录、知识条目、技术指导文章、商品、订单等数据，通过Spring Data JPA进行ORM映射和CRUD操作。用户上传图片则保存在服务器文件系统，Spring Boot静态资源配置映射uploads/目录供前端访问。

### 3.2.2 系统物理/部署架构

在物理部署层面，系统根据不同服务角色分开部署，各组件通过网络通信： - Web前端部署：开发时使用Vite开发服务器（便于热更新调试），生产环境将构建的静态资源部署在Nginx等Web服务器或由Spring Boot静态资源模块直接提供。前端通过配置后端接口地址与后端REST API和WebSocket通信。 - 后端和模型服务部署：后端打包为JAR独立进程运行（如监听8099端口），FastAPI模型服务在Python环境通过Uvicorn启动监听另一个端口（如8001）。后端配置 ml.fastapi.url 指定FastAPI服务地址（例如 http://127.0.0.1:8001），在需要时向该URL发送HTTP请求调用模型。两者可部署在同一服务器不同进程或不同服务器通过内网通信。 - 数据库部署：MySQL数据库作为独立服务（标准3306端口）运行，后端通过JDBC参数连接指定数据库。所有业务数据存储于关系库中，同时用户上传图片等静态文件存储于服务器文件系统（并映射为静态可访问路径），供前端按URL读取。 - 模型训练环境：后端配置中预留了模型训练脚本路径和数据集根目录选项，可在具备GPU的环境中运行Python训练脚本。训练过程可与在线推理服务共用机器或分开部署，但需通过调度避免训练占用资源影响在线推理服务。

## 3.3 功能模块划分

### 3.3.1 前端模块设计

前端通过Vue Router划分多个模块页面，包括首页、识别页、历史记录页、知识库页、技术指导页、消息聊天页、用户个人中心页、购物/订单页、后台管理页等，各模块对应实现相应界面和功能，并通过路由守卫控制页面访问和角色权限，提供一致的用户体验。

### 3.3.2 后端业务模块设计（Spring Boot）

后端逻辑划分为用户权限管理、识别记录管理、病害知识和技术指导内容管理、商品与订单管理、支付集成、WebSocket消息推送、模型服务调用等模块，各模块职责单一、高内聚，构成完整的业务功能集合，为后续扩展和维护提供良好基础。

### 3.3.3 识别模型服务模块设计（FastAPI）

FastAPI 模型服务提供两个主要接口： - /health：返回模型服务状态信息（如模型是否加载成功、物种和病害类别数量、当前运行设备等），供后端监控。 - /predict：接受上传图像执行推理：先进行叶片存在性判别拦截背景，再对确认含叶片的图像调用物种和病害模型预测，返回物种名称、病害名称、置信度及Top-K候选列表的JSON结果。

FastAPI服务地址和端口通过后端配置ml.fastapi.url 指定，例如 http://127.0.0.1:8001，后端调用/predict获取识别结果，调用/health获取服务状态。通过配置化实现后端与模型服务的松耦合集成，方便部署灵活调整

## 3.4 关键技术介绍

### 3.4.1 前端关键技术

前端采用Vue3组合式API和TypeScript开发，利用Element Plus组件库快速构建统一风格的UI界面，并通过Vue Router及导航守卫实现客户端路由控制和访问权限校验（如未登录跳转登录页、非管理员屏蔽后台路由），提高用户体验和前端安全性。

### 3.4.2 后端关键技术

后端基于Spring Boot 3框架，借助其自动配置机制降低开发复杂度。通过Spring Data JPA与MySQL数据库映射实体和仓库接口，简化持久化操作。集成WebSocket支持实现服务器主动向客户端推送消息，满足聊天和通知实时性需求。采用Jsoup、Apache PDFBox等第三方库辅助实现爬取农业资讯内容和生成PDF报告等功能。通过引入支付宝Java SDK规范对接支付宝沙箱环境，封装签名验证和参数构造细节，确保支付流程安全可靠。

### 3.4.3 识别模型与推理服务关键技术

识别模型与推理服务位于 pymodel 子项目中，采用 PyTorch 和 TorchVision 作为深度学习基础框架，结合 FastAPI 和 Uvicorn 构建高性能推理服务。该部分既包括模型结构本身，也包括训练方法和部署方式，是本系统的技术核心之一。

（1）PyTorch 与 TorchVision 深度学习框架。PyTorch 以动态图计算和良好的可扩展性著称，适合进行模型原型设计与调试；TorchVision 则提供了常用的图像变换操作和预训练模型。本系统利用 TorchVision 提供的数据增强与预处理功能（如 Resize、CenterCrop、RandomResizedCrop、ColorJitter 等），构建适合 PlantVillage 数据集的输入流水线；同时使用预训练的 MobileNetV2 网络作为基础模型，在其分类头之上进行迁移学习。

（2）MobileNetV2 轻量级卷积神经网络。考虑到未来在资源受限环境下部署的需要，系统选择 MobileNetV2 作为物种识别模型和病害识别模型的主干网络。MobileNetV2 采用深度可分离卷积和倒残差结构，在保持较高准确率的前提下显著降低了参数量和计算量。通过替换网络末端的分类器层并适配具体的类别数（物种类别数和病害类别数），系统可在 PlantVillage 数据集上完成对不同作物及其病害的分类任务。

（3）两阶段识别框架与叶片存在性模型。PlantVillage 数据集中包含名为 Background_without_leaves 的纯背景类，如果不加区分地与病害图像一起训练，容易导致模型在实际应用中误将纯背景图片判为某种病害。为解决这一问题，系统单独训练了一个叶片存在性二分类模型，将“无叶片背景”作为负类、其他所有类别作为正类。在推理阶段，FastAPI 服务首先调用叶片存在性模型对输入图片计算“无叶片背景”概率和“有叶片”概率，若前者超过严格阈值，则直接判定为纯背景；若处于中间区间，则提示用户疑似背景并建议重新拍摄；仅当图片被判定为含叶片时，才进入物种与病害识别阶段。

（4）数据集划分与数据增强策略。系统在 config.py 中对数据路径、图像大小、批大小、训练轮次等参数进行了集中配置，数据集基于 PlantVillage 原始目录结构组织，并通过脚本生成物种类别名和病害类别名的 JSON 文件，避免训练和部署阶段类别索引不一致。数据集在划分为训练集、验证集和测试集时，确保同一图像不会同时出现在多个子集中，以便对模型的泛化能力进行客观评估。在数据增强方面，根据配置项选择“轻度”“中等”或“强力”增强策略，通过随机裁剪、翻转、旋转和颜色抖动等操作提高模型对光照变化、拍摄角度和背景干扰的鲁棒性。

（5）模型训练流程与超参数设置。主训练脚本 train.py 负责解析命令行参数（如任务类型 --task、设备选择 --device、是否从断点恢复训练 --resume、随机种子 --seed 等），根据任务类型在运行时填充类别名称列表和模型保存路径，然后构建 MobileNetV2 模型并加载相应的预训练权重。训练过程中使用交叉熵损失函数，辅以标签平滑以提高模型泛化能力；通过设置 BATCH_SIZE、LEARNING_RATE、WEIGHT_DECAY、EPOCHS 等超参数以及冻结策略（如部分冻结特征层，仅对后期层进行微调），在训练速度与精度之间取得平衡。训练过程还引入早停机制和学习率调度器，当验证集性能长时间未提升时自动降低学习率或提前终止训练，以避免过拟合和资源浪费。

（6）叶片存在性模型训练与阈值校准。在 leaf_presence.py 中，系统构建了一个专门用于叶片存在性判别的数据集，将所有非背景类样本标记为 1，将 Background_without_leaves 目录中的样本标记为 0。训练时采用类权重平衡策略缓解类别不均衡问题，并使用中等强度的数据增强提高模型对真实场景的适应能力。训练完成后，系统还提供阈值校准函数，对验证集上的“无叶片背景概率”进行统计，寻找能在召回背景与避免误杀正常叶片之间取得较好平衡的阈值组合，并将推荐阈值写入配置，以指导两阶段识别中的拦截逻辑。

（7）FastAPI 推理服务与 GPU 加速。FastAPI 应用在启动时加载训练好的叶片存在性模型、物种模型和病害模型，并根据配置选择运行设备（GPU 或 CPU）。在 GPU 可用时启用 GPU 和混合精度训练/推理；在 Windows 等环境中，通过设置线程数和禁用部分共享内存功能，避免资源冲突。推理过程使用 Uvicorn 作为 ASGI 服务器，结合 FastAPI 的异步特性，实现高并发请求下的稳定响应。通过健康检查接口，后端可以实时了解模型服务当前运行状态，从而在前端界面中显示“模型服务在线/离线”等状态提示。

综上，本系统在识别模型与推理服务部分采用了轻量化网络结构、两阶段识别策略以及合理的训练与部署方案，为整个平台的诊断准确率和响应性能提供了坚实保障。

## 3.5 UML 设计

### 3.5.1 系统包图

为从宏观结构上刻画系统各部分之间的依赖关系，可以通过 UML 包图对系统进行抽象划分。整体上，系统可以划分为以下几类包或子系统：

（1）前端表示层包。包括前端的视图组件、路由配置和通用组件等，主要负责界面展示和用户交互，通过 HTTP 和 WebSocket 与后端通信。

（2）后端接口与控制器包。包括 Spring MVC 控制器、请求映射和参数校验等内容，对外暴露 RESTful API 和 WebSocket 端点，负责接收前端请求并调用相应业务服务。

（3）业务服务与领域逻辑包。包括用户与权限、识别记录、知识与技术指导、商品与订单、支付、消息等领域的服务类，实现具体业务规则和工作流程，是后端逻辑的核心所在。

（4）数据访问与实体包。包括实体类、仓库接口以及与数据库表之间的映射关系，负责持久化相关操作。业务服务层通过调用仓库接口访问 MySQL 数据库，实现对领域对象的增删改查。

（5）模型服务集成包。包括后端与 FastAPI 推理服务交互的封装逻辑，如调用 /health 和 /predict 接口的客户端代码、异常处理和重试机制等，实现对模型服务的统一访问。

（6）Python 端模型与服务包。位于 pymodel 子项目中，包括模型定义、训练脚本、数据加载工具、推理服务和配置文件等。该包独立于 Java 端运行，通过 FastAPI 提供面向 HTTP 的服务接口。

通过上述包的划分，系统在 UML 包图中形成自上而下的依赖关系：前端依赖后端接口，后端控制器依赖业务服务层，业务服务层依赖数据访问层和模型服务集成层，而模型服务集成层与 Python 端模型服务之间则通过网络调用进行连接。

### 3.5.2 核心类图

在类层面上，系统围绕用户与权限、病害知识与技术指导、识别记录与图片资源以及商品与订单等领域构建了一系列核心类。虽然实际实现中类名和属性会随具体编码略有差异，但在设计类图时，主要考虑以下几类对象及其关系：

（1）用户、角色与权限相关类。设计中通常包括“用户”类、“角色”类以及可能的“权限”类或角色枚举。用户类包含用户名、密码散列、昵称、联系方式、创建时间等属性，并通过关联关系与角色类相连；角色类反映用户在系统中的身份，如普通用户、专家用户和管理员等。系统通过在控制器和服务层检查用户角色信息，实现对后台管理界面、知识编辑、订单管理等操作的权限控制。

（2）病害知识与技术指导文章相关类。在病害知识领域，可以设计“知识条目”类，包含标题、作物类型、病害类型、病害概述、症状描述、防治措施等属性；在技术指导领域，可以设计“技术指导文章”类，包含文章标题、正文内容、作者、发布时间、关联作物或病害等属性。知识条目和技术指导文章可以与用户类（例如专家用户）建立关联关系，用于记录内容的创建者或维护者。

（3）识别记录与图片资源相关类。在识别记录领域，可以设计“识别记录”类，用于保存每一次识别请求的关键信息，包括记录编号、所属用户、上传时间、图片路径、识别出的物种和病害名称、置信度分值、调用模型的状态等；同时可以设计“图片资源”或利用简单路径字段，表示图片在文件系统中的存储位置。识别记录与用户之间是一对多关系，即一个用户可以对应多条识别记录。

（4）商品、订单与支付相关类。在交易领域，设计“商品”类（包含商品名称、价格、库存、适用作物/病害、图片等属性）、“订单”类（包含订单编号、用户、订单时间、总金额、状态等属性）、“订单项”类（用于描述订单中某个具体商品及其数量），以及必要时用于记录支付流水的“支付记录”类等。商品与订单项之间是一对多关系，订单与订单项之间同样是一对多关系；订单与用户之间是一对多关系。支付记录通常与订单一一对应，用于记录与支付平台的交互结果。

通过上述核心类及其关联关系，可以在类图中清晰呈现系统的主要数据结构和业务对象，为数据库模式设计和代码实现提供依据。

### 3.5.3 典型时序图

为更直观地展示系统在运行过程中的动态行为，本节从时序图的角度，对“植物病害识别业务流程”和“下单与支付流程”两个典型场景进行描述，并结合识别模型的训练与推理方式进行说明。

（1）植物病害识别业务流程时序图。以普通用户发起一次病害识别为例，主要交互步骤如下：

用户在浏览器中打开前端识别页面，在界面上选择或拍摄叶片图片并点击“开始识别”按钮；

前端将图片数据封装为 HTTP 请求，通过后端暴露的识别接口发送到 Spring Boot 应用；

后端控制器接收到请求后，进行基本参数校验，并将图片转发给模型服务集成模块；

模型服务集成模块根据配置项构造 FastAPI 服务的 /predict URL，将图片以表单数据方式发送到 pymodel 中的 FastAPI 应用；

FastAPI 应用首先调用叶片存在性模型，对图片进行无叶片背景拦截；若图片存在叶片，则继续调用物种识别模型和病害识别模型，生成预测结果和 Top-K 候选列表；

FastAPI 将识别结果打包为 JSON 返回给后端；

后端解析返回结果，并将识别记录、图片路径和用户信息一起写入数据库；

后端将结构化的识别结果返回给前端，前端根据结果刷新界面，展示物种名称、病害名称、置信度及相关知识推荐链接。

该时序图清晰体现了浏览器前端、Spring Boot 后端、FastAPI 模型服务以及数据库之间的调用顺序和数据流转过程。

（2）下单与支付流程时序图。以用户购买某种农资商品为例，主要交互步骤如下：

用户在前端商品详情页面选择商品及数量，并将其加入购物车；

用户在购物车页面点击“结算”进入订单确认页面，确认收货信息和总金额后提交订单；

前端将订单请求发送至后端订单管理模块，后端创建订单记录并返回支付链接或支付参数；

前端根据返回信息跳转到支付宝沙箱支付页面或调起支付窗口，用户在支付宝页面完成支付流程；

支付宝在支付完成后通过同步回调将结果返回给后端，同时通过异步通知接口推送支付结果；

后端支付模块验证回调请求的签名和参数，在验证通过后更新订单状态，并根据需要记录支付流水；

用户在系统订单页面刷新后即可看到最新的订单状态，如“已支付”“已取消”等。

该时序图展示了前端、后端订单模块、支付模块与支付宝支付网关之间的交互逻辑，反映了交易流程中的关键步骤和安全控制点。

（3）模型训练与部署流程补充说明。虽然模型训练过程通常不在日常在线业务中频繁触发，但从系统设计角度，仍可以通过时序图对其进行抽象描述。例如，当管理员或开发者在具备 GPU 的环境中执行训练脚本时：

训练脚本 train.py 被启动，首先读取 config.py 中的数据路径、训练参数和设备配置；

脚本调用数据加载模块构建训练集、验证集和测试集的 DataLoader，应用数据增强和预处理；

脚本调用模型定义模块初始化 MobileNetV2 主干网络，并根据任务类型（物种识别或病害识别）调整输出层和模型保存路径；

训练循环中，脚本依次执行前向传播、损失计算、反向传播和参数更新，并在每个 epoch 后在验证集上评估性能；

当验证集性能达到新高时，脚本将当前模型权重保存到指定路径；当触发早停条件或训练轮次结束时，脚本退出并生成训练曲线等可视化结果；

FastAPI 推理服务在下一次启动或检测到模型权重更新时，从新的权重文件加载模型，完成线上模型的更新。

通过对训练和部署流程的时序描述，可以从整体上把握数据集、模型、训练脚本和推理服务之间的关系，展示系统在模型生命周期管理方面的设计思路。

综上，本章从总体架构、功能模块划分、关键技术和 UML 视角对系统进行了全面的总体设计说明，为后续第4章的详细设计与实现奠定了基础。

# 第四章 系统详细设计与实现

本章基于第2章需求和第3章总体设计，从数据集与预处理、识别模型设计与训练实现、模型推理服务实现以及业务系统前后端和数据库实现几个方面详细阐述系统的实现过程，重点突出模型算法相关的技术细节。

## 4.1 数据集与数据预处理

### 4.1.1 PlantVillage 数据集介绍

本系统采用 PlantVillage 植物病害公开数据集作为模型训练和测试的基础。PlantVillage 数据集中包含多种作物叶片及其病害的图片样本，数据量大、病害类型丰富、标注规范。数据集以“作物名___病害名”组织目录结构，另有一个名为 Background_without_leaves 的纯背景类别目录。系统使用前，会先解析目录名称，将其拆分出作物类别和病害类别两部分，分别建立物种类别列表和病害类别列表，供双模型任务使用。

### 4.1.2 数据清洗与质量过滤

为保障训练数据质量，系统对 PlantVillage 原始图片进行了清洗过滤。主要包括：剔除分辨率过低的图片（如最短边长度小于80像素）、剔除长宽比极端异常的图片（超过设定阈值可能为异常裁切样本）、排除文件名含“crop”等关键词的疑似拼接/裁剪图片。通过这些过滤规则，有效去除了模糊失真、裁剪不完整或异常合成的图片样本，从而提高训练集的整体质量，保证模型学习更加稳定可靠。

### 4.1.3 数据集划分策略

为客观评估模型性能并避免数据泄漏，系统将 PlantVillage 数据集按约7:2:1的比例划分为训练集、验证集和测试集。划分过程中确保同一张图片仅出现在一个子集中，以严格区分训练数据和评估数据。同时，系统扫描类别文件夹名称提取作物种类集合和病害种类集合，排序后分别保存为 species_class_names.json 和 disease_class_names.json 文件，在训练和推理时加载，确保类别索引和名称映射关系一致。另外，为避免背景类干扰主分类任务，系统在配置 EXCLUDE_CLASSES=["Background_without_leaves"] 将 PlantVillage 的纯背景类别从物种和病害识别模型训练集中剔除，仅将其用于训练叶片存在性二分类模型，从数据层面对任务进行解耦。

### 4.1.4 数据增强策略

为增强模型对光照变化、视角变化等因素的鲁棒性，训练阶段引入多种数据增强策略。根据配置的 AUGMENTATION_LEVEL 选择轻度、中等或强力增强，对训练集应用随机裁剪缩放（RandomResizedCrop 等）、随机水平翻转（RandomHorizontalFlip）、随机旋转（RandomRotation）和颜色抖动（ColorJitter）等图像变换操作，模拟不同拍摄距离、角度和光照条件，提高模型对多变环境的适应能力。而验证集和测试集则采用统一的 Resize + CenterCrop + Normalize 预处理流程，以保证评估结果的一致性和可比性。

## 4.2 识别模型总体设计

### 4.2.1 任务定义与总体框架

根据系统需求，模型层定义了三个相互关联的子任务：物种识别（给定叶片图像判断所属作物种类，如苹果、番茄等）、病害识别（判断叶片是否患病以及患何种病害，包括健康与具体病害类别）和叶片存在性判别（判断输入图像中是否包含作物叶片，用作前置过滤）。系统采取“两阶段识别”策略： - 阶段1：叶片存在性拦截：先将输入图像送入叶片存在性二分类模型，输出其属于“无叶片背景”的概率。当该概率高于预设的严格阈值时，认为图片不含作物叶片，直接返回纯背景判断并终止后续识别；若该概率处于普通阈值与严格阈值之间，则返回“疑似背景”结果，提示用户图片可能无叶片且建议重新拍摄；只有当模型判断图片中存在叶片（即“无叶片背景”概率低于普通阈值）时才进入阶段2。 - 阶段2：物种识别与病害识别：对通过阶段1筛选的图像，分别输入物种识别模型和病害识别模型进行推理，得到作物种类预测结果和病害类型预测结果，并同时返回 Top-K 候选类别及置信度，供用户参考。两阶段结果综合后向用户展示最终诊断结论。

通过上述两阶段框架，系统在保证诊断准确率的同时，有效减少了对纯背景和无效图片的误判，极大提升了识别结果的可靠性。

### 4.2.2 模型结构选择与对比

模型结构选择需要在识别精度、推理速度和部署成本之间取得平衡。考虑到 ResNet、DenseNet 等传统CNN尽管准确率高，但参数量和计算量较大，不利于资源受限环境或高并发场景部署，本系统选用 MobileNetV2 作为物种和病害识别模型的主干网络。MobileNetV2 属于轻量级卷积神经网络，采用深度可分离卷积和倒残差结构，在大幅降低参数和运算量的同时仍保持较高的分类性能，特别适合在GPU/CPU算力有限或需要快速响应的Web服务中使用。此外，MobileNetV2 提供了在 ImageNet 上预训练的权重，可用于迁移学习，大幅缩短训练时间并提高模型在农作物病害任务上的收敛速度和准确率。综合考虑以上因素，本系统分别基于 MobileNetV2 构建了物种识别模型和病害识别模型，并引入独立的叶片存在性模型，共同组成整体的诊断模型架构。

## 4.3 模型结构与训练细节

### 4.3.1 MobileNetV2 主干结构设计

MobileNetV2 的核心结构是一系列倒残差瓶颈块（Inverted Residual Blocks），通过“1×1 卷积升维 → 3×3 深度可分离卷积 → 1×1 卷积降维”的流程提取特征，并在输入和输出之间添加残差连接，以在减少计算量的前提下保持模型的表达能力。在本系统中，物种识别模型和病害识别模型均基于 TorchVision 提供的 MobileNetV2 ImageNet 预训练模型，仅对最后的分类输出层进行修改： - 保留MobileNetV2主干的大部分卷积层和瓶颈结构，充分利用预训练模型学到的通用视觉特征； - 替换模型末端的全连接分类层，将原针对 ImageNet 1000 类的输出层改为适配物种类别数或病害类别数的新输出层； - 在新分类层之前加入一个适当的 Dropout 层（如 dropout 概率约0.3），以降低过拟合风险，特别是针对样本相对较少的类别。

通过上述改动，使MobileNetV2主干网络既保留了预训练模型较强的特征提取能力，又能以较小的调整适应 PlantVillage 数据集的具体分类任务，达到了精度与效率的平衡。

### 4.3.2 物种识别模型

物种识别模型以 MobileNetV2 为骨干，其输出节点数与物种类别列表 SPECIES_CLASS_NAMES 的大小一一对应。具体实现方面： - 在数据加载阶段，扫描 PlantVillage 数据集各类别文件夹的前缀部分（即“作物名”），收集所有不同的作物种类并排序，保存为 species_class_names.json 文件，在运行时从配置的 SPECIES_CLASS_NAMES_JSON 路径读取； - 构建物种模型时，根据物种类别列表长度设置 MobileNetV2 分类头输出层的神经元数量； - 在训练过程中，通过 SPECIES_MODEL_SAVE_PATH 配置项指定物种模型权重保存路径，验证集性能每有提升即保存对应权重文件； - FastAPI 推理服务启动时，调用辅助函数 get_model(num_classes=len(SPECIES_CLASS_NAMES)) 构建物种模型实例，随后加载训练得到的 SPECIES_MODEL_SAVE_PATH 路径下的最佳权重，并将模型切换为 eval 模式。

通过上述设计，物种识别模型能够针对输入的叶片图像给出对应的作物种类预测，为病害识别结果提供前提信息，也可在前端用于结果展示和上下文提示。

### 4.3.3 病害识别模型

病害识别模型的结构与物种识别模型类似，同样以 MobileNetV2 作为骨干，不同之处在于输出空间对应病害类别列表 DISEASE_CLASS_NAMES 中的各病害类别。主要实现过程为： - 数据加载阶段解析 PlantVillage 类别文件夹名称，提取每个目录名中的“病害名”部分，将其中表示健康叶片的类别归并为统一的“健康”类，然后收集所有病害类别，排序后保存为 disease_class_names.json 文件（路径由 DISEASE_CLASS_NAMES_JSON 指定）； - 构建病害模型时，根据病害类别数量调整 MobileNetV2 分类头的输出维度； - 训练过程中通过 DISEASE_MODEL_SAVE_PATH 指定病害模型权重文件保存路径； - FastAPI 服务启动时，实例化病害识别模型并加载训练保存的最佳权重，同样将模型设置为 eval 模式。在推理时对输入图像计算各病害类别的概率分布，选取概率最高的类别作为病害预测结果，并提供 Top-K 候选列表。

物种识别模型和病害识别模型相互独立却结构类似，两者共同实现了系统对输入图像的双维度诊断能力。

### 4.3.4 叶片存在性二分类模型

叶片存在性二分类模型用于判断输入图像中是否包含作物叶片，从而在推理阶段对纯背景或无效图片进行前置过滤。模型设计要点如下： - 任务定义：将该问题视为二分类，类别0表示“无叶片背景”（Negative 类，由 PlantVillage 数据集 Background_without_leaves 目录中的图片构成），类别1表示“有叶片”（Positive 类，由除背景类外所有类别的图片构成）； - 模型结构：基于 ImageNet 预训练的 MobileNetV2，调整分类头为2个输出，并在全连接层前加入 Dropout 层提升泛化性能； - 数据集构建：遍历 PlantVillage 数据集各类别目录，将 Background_without_leaves 目录下的所有图像标注为0，将其余类别目录下的图像标注为1，组合形成叶片存在性模型的数据集。由于正负样本数量高度不均衡，为保证训练效果，对正负样本分别随机下采样至设定的最大数量，以减轻类别不平衡问题； - 训练策略：在交叉熵损失函数中加入类别权重，使模型在训练时对少数类（背景类）予以更多关注，同时应用与主任务类似的中等强度数据增强提高模型对不同背景场景的适应能力。

通过上述方法，训练得到的叶片存在性模型可以较准确地区分纯背景图像和含叶片图像，为两阶段识别框架提供可靠的前置判断基础。

### 4.3.5 训练超参数与优化策略

系统使用 config.py 统一配置模型训练的主要超参数和优化策略，以便集中管理和调整。关键参数包括：

批大小（BATCH_SIZE）：每个训练批次包含的样本数，直接影响训练速度和显存占用；

图像尺寸（IMAGE_SIZE）：将输入图像统一缩放到的尺寸，如224×224，与 MobileNetV2 默认输入匹配； 

训练轮数（EPOCHS）：最大训练迭代次数，通常结合早停机制决定实际训练轮次； 

学习率（LEARNING_RATE）及权重衰减（WEIGHT_DECAY）：控制梯度更新步长和L2正则化强度，是影响模型收敛和防止过拟合的关键参数； 

冻结策略（FREEZE_STRATEGY）及解冻层数（UNFREEZE_LAST_BLOCKS）：指定迁移学习中MobileNetV2的哪些卷积层参与训练。选取合适的冻结方案（完全冻结、部分冻结或仅冻结BatchNorm层等）可以在训练速度和精度之间取得折衷； 

标签平滑（LABEL_SMOOTHING）：设置在计算交叉熵损失时对目标标签的平滑程度（如0.1），有助于降低模型过度自信，提高泛化性能；

早停耐心值（EARLY_STOP_PATIENCE）和学习率调度耐心值（LR_SCHEDULER_PATIENCE）：控制训练过程中的调整策略。当验证集性能在若干轮内无提升时，降低学习率或提前停止训练，避免过拟合和资源浪费；

自动混合精度训练（USE_AMP）：在GPU环境下是否启用混合精度训练，以减少显存占用和加速训练。

通过合理选择和调整上述超参数，并辅以实验验证，系统在 PlantVillage 数据集上实现了模型训练过程的稳定高效，确保模型能够充分学习而不过度拟合，为模型在实际部署中的良好表现提供保障。

## 4.4 模型训练流程实现

### 4.4.1 主训练脚本设计

主训练脚本 train.py 负责组织物种识别和病害识别模型的训练流程，主要步骤如下： 1. 命令行参数解析：使用 argparse 定义 --task（选择 species 或 disease 任务）、--device（指定训练设备，如 cuda:0 或 cpu）、--resume（是否从上次断点恢复）、--seed（随机数种子）等参数，以便灵活调整训练配置； 

2. 日志初始化：配置日志记录器，将训练过程中的关键信息（如每轮loss、准确率等）输出到控制台或日志文件，便于监控训练进度和排查问题； 

3. 设备选择：根据命令行参数和系统环境优先选择可用的GPU设备进行训练（若有），否则回退至CPU。若使用GPU，启用 cuDNN benchmark 模式以优化卷积操作性能； 

4. 随机种子设定：统一设置 Python、NumPy、PyTorch 等随机数种子，确保训练在给定配置下结果具有较好的可复现性； 

5. 数据加载：根据任务类型（species 或 disease），调用数据加载模块构建训练集和验证集 DataLoader。加载过程中应用前述的数据清洗和增强策略，并视情况使用类别均衡采样器以缓解数据不平衡对训练的影响； 

6. 模型构建：读取相应的类别名列表，实例化 MobileNetV2 模型并调整输出层节点数，使其匹配当前任务的类别数；根据配置决定是否冻结部分卷积层，只训练最后若干层，从而实现迁移学习微调； 

7. 训练循环：调用封装好的 train_model 函数开始模型训练迭代。每个 epoch 中遍历训练集计算损失并更新模型参数，每轮结束后在验证集上评估性能，并根据配置应用学习率调度或判断是否满足早停条件。如验证集指标达到历史最佳，则保存当前模型权重； 

8. 结果输出：训练完成后，绘制训练损失和准确率随 epoch 变化的曲线，并打印最优模型权重文件路径和验证集最终性能指标，为后续模型测试或部署提供参考。

通过以上流程设计，train.py 实现了对训练全流程的高层次管理，使不同任务和配置下的模型训练工作能够方便地复用和拓展。

### 4.4.2 叶片存在性模型训练与校准

叶片存在性模型训练主要在 leaf_presence.py 中实现，其流程包括： 

1. 数据集构建：定义 BinaryImageDataset 类，从 PlantVillage 数据集中同时收集背景类和非背景类样本。在初始化时，扫描 Background_without_leaves 目录将其下图像标记为0（无叶片），扫描其它类别目录将图像标记为1（有叶片），记录样本路径列表； 

2. 子采样和平衡划分：鉴于标记为有叶片的样本数量远多于无叶片样本，脚本对子采样正负样本以限制两类最大样本数，提高训练效率并减轻不平衡影响。然后将处理后的数据集划分为训练集和验证集； 

3. 数据增强与加载：定义训练集数据增强流水线：组合使用 RandomResizedCrop、RandomHorizontalFlip、RandomRotation、ColorJitter 等操作；验证集采用 Resize + CenterCrop + Normalize 的固定预处理。之后构建训练和验证 DataLoader，以批处理方式加载数据； 

4. 模型与损失定义：创建基于 MobileNetV2 的二分类模型，根据训练集正负样本数计算类别权重，构造带类别权重的交叉熵损失函数（可选结合标签平滑），以在损失计算中弱化多数类影响，提升模型对少数类的关注； 

5. 训练迭代与最优保存：迭代训练模型参数，每个 epoch 后在验证集计算准确率。一旦验证准确率优于历史记录，保存当前模型权重至配置的 LEAF_PRESENCE_MODEL_PATH 路径下，确保最佳模型权重得到持久化保存； 

6. 阈值校准：提供 calibrate_thresholds 函数，在模型训练完成后调用。该函数在验证集上统计叶片存在性模型输出的“无叶片背景”概率分布，根据不同阈值下的背景图片召回率、正常叶片保留率等指标，推荐一组“普通阈值”和“严格阈值”的组合，并更新配置文件中的 LEAF_PRESENCE_THRESHOLD 和 LEAF_PRESENCE_NO_LEAF_THRESHOLD，用于推理阶段的背景拦截决策。

### 4.4.3 模型保存与加载策略

系统在模型训练和部署阶段采用统一的权重文件保存与加载策略： - 训练阶段保存：每当验证集性能提升时，调用 torch.save 将模型 state_dict 保存至指定路径（如 SPECIES_MODEL_SAVE_PATH、DISEASE_MODEL_SAVE_PATH、LEAF_PRESENCE_MODEL_PATH 等，均位于 pymodel/saved_models 目录下），确保最佳权重被记录； - 推理阶段加载：FastAPI 服务使用自定义 safe_torch_load 函数读取权重文件，内部处理因 PyTorch 版本或设备差异引起的兼容问题，并在加载失败时输出明确错误信息；服务启动时依次构建物种、病害和叶片存在性模型结构，使用 safe_torch_load 加载各自的权重文件并将模型设为 eval 模式；针对叶片存在性模型，实现基于文件更新时间的热更新机制：FastAPI 服务运行过程中监视叶片模型权重文件的修改时间，一旦检测到文件更新，可自动重新加载模型权重，使训练好的新模型无需重启服务即可投入使用。

通过以上策略，训练过程和部署过程实现了良好的衔接：模型在验证集上表现最佳的权重能够及时应用到在线推理服务中，同时采用安全加载机制避免潜在的版本兼容问题，让模型更新升级过程更加顺畅高效。

## 4.5 模型推理服务设计与实现

### 4.5.1 FastAPI 推理服务结构

模型推理服务基于 FastAPI 框架实现，入口脚本位于 pymodel 项目目录下。服务启动时完成如下初始化步骤： - 应用实例创建：实例化 FastAPI 应用对象，设置应用标题、版本等元数据； - CORS 中间件：添加跨域资源共享中间件，允许前端来源、请求方法、请求头等，以避免浏览器的跨域请求限制； - 类别名加载：应用启动时运行初始化函数，从 JSON 文件或数据集目录读取物种类别名列表和病害类别名列表，保存到全局变量或配置项，供模型初始化使用； - 模型初始化：根据加载的类别名列表长度分别实例化物种识别模型和病害识别模型，加载训练好的权重文件（由 SPECIES_MODEL_SAVE_PATH、DISEASE_MODEL_SAVE_PATH 指定）并将模型设为 eval 模式；如果存在叶片存在性模型权重文件，则加载对应模型权重，否则在推理时跳过叶片判别步骤； - 图像预处理定义：使用 torchvision.transforms.Compose 定义推理阶段统一的图像预处理流水线，包括 Resize、CenterCrop、ToTensor、Normalize 等操作，用于将输入图像转换为模型接受的tensor格式； - 健康检查接口：实现 GET /health 路由，读取模型服务状态信息（如模型加载是否成功、物种和病害类别数量、当前运行设备CPU/GPU等）并返回 JSON 数据，以供后端监控模型服务健康状况或前端显示模型服务在线状态。

通过一次性完成模型加载和预处理配置，FastAPI 服务在每次请求中仅需执行推理过程，避免重复初始化开销，提高了推理效率。

### 4.5.2 /predict 接口实现

/predict 接口是系统提供病害识别服务的核心接口，其工作流程如下： 1. 接收文件与初步校验：接口通过 FastAPI 的文件上传功能接收前端上传的图片文件，首先尝试读取文件字节内容并检查是否为空文件。如果读取失败或文件内容为空，则返回 HTTP 400 错误和相应提示，终止后续处理； 2. 图像读取与预处理：如果文件读取正常，使用 Pillow 库将字节流解码为 RGB 图像对象，然后将图像输入预定义的 transforms 流水线执行预处理，包括调整尺寸（Resize）、中心裁剪（CenterCrop）、转换为 Tensor 格式（ToTensor）、标准化（Normalize）等，将图像转换为模型输入所需的tensor，并根据配置将tensor移动到CPU或GPU计算设备上； 3. 阶段1 – 叶片存在性判别：如果叶片存在性模型已加载，则先用该模型对预处理后的图像tensor进行推理，得到输出的“无叶片背景”概率和“有叶片”概率（通常softmax后取第0类和第1类概率）。根据配置中定义的普通阈值 LEAF_PRESENCE_THRESHOLD 和严格阈值 LEAF_PRESENCE_NO_LEAF_THRESHOLD 判断： - 当“无叶片背景”概率 ≥ 严格阈值时，模型高度确信该图像没有叶片，则接口直接返回判定结果表示图片为纯背景，并在响应JSON中标记拦截类型为“Background”； - 当“无叶片背景”概率介于普通阈值和严格阈值之间时，模型不确定图像中是否有叶片，则返回结果标记为“Suspected Background”，提示用户图像可能无关紧要并建议重新拍摄更清晰的叶片照片； - 仅当“无叶片背景”概率 < 普通阈值时（即模型认为图像中存在叶片），接口才继续执行阶段2 的物种和病害识别。 4. 阶段2 – 双模型识别：通过阶段1筛选后，接口分别调用物种识别模型和病害识别模型对图像tensor进行推理，获取各自的logits输出，并通过 softmax 计算概率分布。然后各自取概率最高的类别作为预测的作物种类和病害类型，将其名称和对应概率作为主要结果；同时根据Top-K配置获取若干候选类别及其概率列表（如Top-3物种、Top-3病害），一并纳入结果返回，以便前端展示给用户更多参考信息。 5. 结果封装与响应：接口将物种预测结果和病害预测结果组织为JSON对象，包括主要预测的类别名称及置信度、Top-K候选类别和置信度列表、服务器处理时间戳以及拦截阶段标记（Background/Suspected/None 等）。正常情况下返回HTTP 200并附上结果JSON。如推理过程中发生异常（例如模型服务计算错误、内存不足等），则捕获异常返回HTTP 500错误和一个带错误描述的JSON，供前端显示友好错误提示。

通过严格的输入校验、两阶段模型推理流程和结构化结果输出，/predict 接口为后端业务服务提供了清晰、可靠的病害识别结果，方便后续的集成存储和处理。

### 4.5.3 与后端的集成

后端 Spring Boot 应用通过配置项 ml.fastapi.url 指定FastAPI模型服务的基地址。后端在实现识别相关的REST接口时，通过以下方式集成 FastAPI 服务： - 调用 /predict 获取识别结果：当后端收到前端上传的图片识别请求后，使用Http客户端将图片文件以表单数据转发到${ml.fastapi.url}/predict，获取FastAPI服务返回的模型推理结果JSON。若调用成功返回，后端解析出物种名称、病害名称及置信度等字段，将识别记录（包括关联的病害知识防治建议等）存入数据库，然后将结构化结果返回前端；若调用超时或失败，则记录异常日志并返回统一的错误提示给前端（如“识别服务暂不可用，请稍后重试”）。 - 健康检查接口代理：为方便前端统一获取模型服务状态信息，后端实现一个GET /detect/health 接口，该接口内部向 FastAPI 服务的 /health 端点发送请求，得到模型服务状态数据后进行封装（例如fastapiAvailable标志），然后返回给前端。前端全局布局组件定期调用这个代理接口，根据 fastapiAvailable 的值在界面上显示“模型服务在线”或“模型服务离线”等状态提示，提升系统可观测性。

通过上述集成方式，业务后端与 FastAPI 模型推理服务在逻辑上保持松耦合关系：仅通过配置项绑定和HTTP请求交互实现合作，使模型服务的独立部署和更新不需要修改后端代码；同时后端通过代理健康检查接口将模型服务状态透明地传递给前端，有助于用户及时了解系统功能可用性。

## 4.6 业务系统详细实现

### 4.6.1 前端实现

前端实现集中在 bysj-mtj-web 子项目，采用 Vue3 + TypeScript + Element Plus 构建SPA应用。根组件 App.vue 定义了统一的布局和导航，包括： - 页面顶部导航栏，包含系统Logo、主要功能路由链接（如首页、识别、历史记录、知识库、技术指导、消息、购物车等）以及模型服务在线状态指示和用户信息（头像、昵称、角色或登录按钮）。导航菜单根据当前路由动态高亮，并根据用户角色（如管理员）显示不同的菜单项（如后台管理入口）。 - 前端通过统一封装的Axios API模块与后端通信，并对响应做统一处理：在网络或业务错误时弹出提示消息。例如： - 在病害识别页面，用户通过上传组件选择叶片照片，触发前端调用后端识别接口上传文件。期间前端可显示加载动画，待接口返回后，如果成功，则解析结果在界面展示物种名称、病害名称、置信度，并提供按钮跳转到相应病害知识详情、技术指导文章和推荐商品页面；如返回错误，则根据错误信息提示用户稍后重试或联系管理员。 - 在历史记录、知识库、技术指导、购物车、订单等页面，组件创建时前端发送异步请求加载相关列表数据或详情数据，收到响应后渲染界面，支持分页加载、条件搜索和跳转查看等操作。 - 在聊天消息页面，前端使用WebSocket与后端建立长连接，实时接收服务器推送的新消息，用户发送消息时也通过REST接口提交，待服务器响应确认后再本地显示。WebSocket 连接异常时，前端会每隔一定时间轮询后端以获取未读消息，实现准实时通信。 - 在客户端权限管理上，前端在用户登录成功后将用户信息（如token或用户ID和角色）存储于浏览器 sessionStorage，并在Vue Router的全局导航守卫中检查每次路由跳转：如果目标路由需要登录而当前无登录信息，则自动重定向到登录页；如果目标路由需要管理员角色而当前用户不是管理员，则重定向到首页。这样在前端就能基本防止未登录或权限不足用户访问受限页面（同时配合后端接口的鉴权检查确保安全）。

### 4.6.2 后端实现

后端实现集中在 springboot 子项目，遵循Spring Boot分层架构。通过多个REST控制器分别处理用户认证、图片识别、知识内容、商品订单、消息通知、管理员后台等模块请求，内部调用对应服务类执行业务逻辑，并通过Spring Data JPA与MySQL数据库交互实现数据持久化。主要流程如：识别接口接收前端上传图片后调用FastAPI模型服务获取预测结果并存入识别记录库再返回前端；知识和指导内容接口提供查询浏览功能，专家/管理员通过授权接口对内容增删改；订单接口创建订单记录并调用支付服务更新订单状态，支付结果通过回调或轮询更新数据库并通知前端；消息接口维护好友关系和聊天记录，利用WebSocket实时推送聊天消息给在线用户；管理员接口则封装上述模块的管理操作供后台界面使用。关键参数如数据库连接、模型服务URL、支付密钥等通过配置文件统一管理，方便根据部署环境灵活调整。

### 4.6.3 数据库设计

系统数据库采用MySQL，主要表包括用户、识别记录、知识条目、技术指导文章、商品、订单等，并通过外键建立合理关联。采用Spring Data JPA将这些表映射为实体类并提供仓库接口，简化了数据库CRUD操作。数据库模式设计保障了系统各业务数据的有效存储和快速访问，为功能实现提供了可靠的数据支撑。

# 第五章 系统测试与识别模型评估

系统测试是保障软件质量和可靠性的重要环节。本章在前几章需求分析和设计基础上，从测试环境与工具、测试方法与策略、功能测试、识别模型测试与评估、性能测试以及测试结果分析等方面对本系统进行测试说明。通过系统性测试验证各功能模块的正确性与稳定性，评估识别模型的效果，并分析系统在一定负载下的性能表现，为后续优化提供依据。

## 5.1 测试环境与工具

测试环境与开发环境接近：在Windows PC上运行前端、后端和模型服务，安装JDK17、Python3（含PyTorch、FastAPI库）、MySQL8等软件。测试中使用Postman进行接口调用验证，浏览器开发者工具用于前端页面调试和网络请求监控，JMeter 用于模拟并发请求压测性能，系统日志用于观察运行状态和排查错误。

## 5.2 测试方法与测试策略

### 系统测试采用多种方法相结合的策略，从不同层次和角度对系统进行验证：

### 5.2.1 黑盒测试与白盒测试

黑盒测试：主要面对各业务功能模块，从用户视角验证输入输出正确性，不关心内部实现（如登录功能输入正确凭证成功登录、错误凭证给出提示，识别功能上传合规图片返回诊断结果，无效图片返回错误提示等）。

白盒测试：针对关键模块（模型服务集成、支付回调处理、数据库DAO等），通过代码走查或单元测试检查逻辑分支覆盖率和异常处理情况，确保系统在各种极端情况下仍按预期运行，不会因未处理异常导致崩溃。

### 5.2.2 单元测试、集成测试与系统测试

从测试层次来看，本系统的测试可以划分为以下几个层次：

单元测试：针对某些具有独立逻辑的函数或方法（如数据预处理函数、结果格式化函数等）进行针对性测试，验证其在边界条件和异常输入下的行为是否正确；

集成测试：将前后端或后端与模型服务、数据库等多个组件组合起来进行联调，重点验证接口之间的调用是否正确，数据在不同模块间传递和转换是否准确；

系统测试：在系统整体搭建完成后，从用户操作流程角度验证系统是否满足第2章中提出的功能和非功能需求，包括多角色登录、识别业务、知识和技术指导、购物与订单、消息和通知、后台管理等完整业务场景。

### 5.2.3 回归测试策略

在开发迭代过程中，针对每次修改或新增功能，重新运行相关测试用例验证未引入新错误。特别对核心功能（登录认证、识别流程、支付流程等），建立一套简化的回归测试集，在每次版本更新前手动或自动执行一次，确保系统改动不会破坏已有功能的稳定性。

## 5.3 功能测试

功能测试主要围绕系统的各个业务模块展开，依据第2章功能需求分析中提出的模块划分，对登录、识别、历史记录、知识库、技术指导、购物、订单、支付、聊天和管理后台等主要功能进行逐项验证。

### 5.3.1 功能模块测试用例设计

针对主要功能模块设计测试用例，覆盖各种情形。部分测试点示例：

登录与注册模块：测试正确账号密码登录、错误账号或密码登录、未填写必填字段、重复注册用户名等情况，验证系统对不同输入的响应是否符合预期；

植物病害识别模块：测试在登录状态下上传不同类型的图片（清晰叶片图像、模糊或部分遮挡图像、纯背景图像、非图像文件等），观察识别结果和错误提示是否合理；

历史记录模块：测试存在和不存在历史记录的情况，验证列表展示、详情查看以及根据时间等条件筛选的正确性；

知识库与技术指导模块：测试知识条目和技术指导文章列表加载、详情展示、分类筛选和搜索等功能，并验证与识别结果联动跳转是否正确；

购物与订单模块：测试商品列表与详情展示、加入购物车、购物车数量修改与删除、订单创建、订单状态查看等流程；

支付流程：在测试环境中模拟通过支付宝沙箱完成支付，验证支付请求发起、回调处理和订单状态更新是否正确；

聊天与消息模块：测试消息发送与接收、刷新页面后消息记录是否保留、系统通知的推送和展示情况；

管理后台模块：测试管理员登录后访问用户管理、知识管理、技术指导管理、商品与订单管理等页面的权限控制和基本操作，验证非管理员访问后台时是否被正确拦截。

### 5.3.2 测试用例表与执行结果记录

为每个功能模块整理测试用例表，包括用例编号、测试目标、前置条件、输入操作、期望输出和实际结果等字段，详实记录测试过程。执行所有用例后，绝大多数功能均如期望运行：系统允许普通用户顺利完成识别、查询、购物、支付全流程操作，专家和管理员角色的特定功能也表现正常；出现的少量小问题（如一个提示消息措辞不够准确、个别异常流程提示不友好）在测试中发现并反馈开发修改后重新测试通过。测试结果证明系统各功能模块达到了需求规格的要求。

## 5.4 识别模型测试与评估

识别模型作为系统核心部件，需要进行专门的性能评估，以衡量模型诊断准确率和实际效果。主要评估内容包括： 

### 5.4.1 测试集性能指标

在独立的 PlantVillage 测试集上评估物种识别模型和病害识别模型的分类性能，计算总体准确率、各类别 Precision（查准率）、Recall（召回率）和 F1-score 等。结果表明，两模型总体准确率较高，各主要类别 Precision/Recall 均超过90%，表现理想。

### 5.4.2 混淆矩阵分析

绘制物种模型和病害模型在测试集上的混淆矩阵，从中观察模型易混淆的类别对。例如发现病害模型偶尔将一种病斑误分类为另一种形态相似的病斑，但总体混淆率较低，不影响模型整体适用性。物种模型几乎没有跨物种的误判。

### 5.4.3 错误案例检查

人工检查少数模型预测错误的测试样本，分析原因。发现模型极少数错误多发生在叶片图像质量较差、病斑症状不典型或病情早期、某些病害类别样本很少的情况下。这说明模型可能对个别弱势类别的区分能力不足，未来可通过增加该类样本或改进模型结构来优化。

### 5.4.4 叶片存在性模型拦截效果

测试集背景类图片经叶片存在性模型拦截后几乎全部成功过滤，未出现被误识别为某病害的情况；同时对所有正常叶片图片叶片存在性模型均未错判为背景（可能有少量临界情况给出“疑似背景”警告但仍允许识别）。这证明叶片存在性模型配合两阶段阈值策略在减少背景误诊的同时没有明显影响正常叶片的识别，通过背景拦截提升了系统诊断结果的可靠性。

综上，模型评估结果表明：物种和病害识别模型在 PlantVillage 数据上的分类准确率满足设计要求，叶片存在性二分类模型有效降低了纯背景图像导致的误判，两阶段识别框架成功兼顾了诊断准确性和实用性。

## 5.5 性能测试

性能测试旨在评估系统在并发访问下的响应速度和资源占用情况，确保系统可满足一定用户规模的实时使用需求。测试环境模拟多个用户同时使用系统的场景，对关键接口进行压力测试：

### 5.5.1 模型推理接口并发测试

使用 JMeter 模拟 10、20、50 等不同并发用户同时调用识别接口。结果显示并发10或20时，FastAPI 推理服务平均响应时间约1~2秒，95%响应时间在3秒以内；并发增加到50时，平均响应有所上升（约3秒），极少数响应在5秒左右但无超时，表现仍稳定可接受。说明在典型农户用户规模下，模型推理接口可以满足实时性要求。

### 5.5.2 主要业务接口并发测试

模拟多个用户同时浏览知识库列表或下单结算等操作。测试发现这些接口大多为读操作或快速写操作，MySQL 数据库在当前数据量和并发下表现轻松，接口平均响应时间维持在50~200毫秒之间，几乎不受并发影响。购物下单接口在50并发下平均响应时间也仅约300毫秒，因为订单写入和支付请求构建逻辑简单快速。

### 5.5.3 系统资源监控

在并发压力下，通过系统监视工具观察服务器 CPU、内存和GPU 使用率。测试过程中后端Java进程CPU占用一直较低（在20%以下），内存占用平稳无明显增长，Python模型服务在GPU模式下GPU利用率约40~60%，显存占用稳定，无内存泄漏迹象；MySQL数据库CPU、IO负载也都很低。服务器整体负载较轻，有充裕余力应对更多并发需求。

综合性能测试结果表明：在中等并发（多个同时用户）场景下，系统各关键接口响应时间均在合理范围内，无论模型推理还是普通业务操作均能及时完成，且系统各组件资源占用保持稳定，没有发现明显瓶颈和异常。由此可见，当前系统架构设计较为高效，可满足预期的用户访问量需求。如将来用户数显著提升，只需增加模型服务节点或提升硬件配置即可进一步扩展系统处理能力。

## 5.6 测试结果分析与问题总结

通过以上功能、模型和性能测试，可以看出本系统在主要方面达到了设计要求： 

功能完整性：系统各项功能经严格测试均能够正确执行。普通用户可以顺利完成诊断、查询、购物、支付等操作，专家用户和管理员的特殊功能也运转正常。测试中发现的一些小问题已在修改后重测通过，确保了功能逻辑的正确性和用户操作的友好性。 

模型准确性：识别模型在PlantVillage测试集上实现了较高准确率，绝大多数作物和病害类别都能精确识别。两阶段识别策略成功减少了背景图片造成的误判，模型诊断结果可信度高。尽管存在极少数难分样本导致的误差，但不影响模型整体实用性，这些弱点可在后续通过增加样本或改进算法进一步改善。 

性能稳定性：在预期的同时在线用户范围内，系统服务器资源充裕，接口响应迅速稳定，没有发生超时或崩溃等现象，证明系统具备在真实环境中连续服务的能力。为更大规模用户访问做好准备，系统也易于通过横向扩展模型服务或升级硬件来提高吞吐能力。

当然，通过测试也暴露出一些可以改进之处：例如模型对某些边缘情况（如非常模糊的图片或极罕见病害）的处理仍有提升空间；系统目前尚未经历特别长时间高负载的运行测试，稳定性还有待持续观察。但整体而言，本次测试验证了系统在功能、性能方面已达到设计目标，可以投入实际试用。后续仍需在真实应用环境中持续监测系统表现，不断优化改进使系统更加完善。

# 第六章 总结与展望

## 6.1 工作总结

本课题完成了一个深度学习植物病害诊断与辅助决策系统的设计与实现工作。具体而言： - 在需求分析阶段，梳理了植物病害对农业生产的影响以及传统诊断方式的局限性，调研了国内外基于图像的病害识别研究现状，明确了构建面向农户的病害智能诊断与辅助决策平台的研究意义和目标。 - 在系统需求分析和总体设计阶段，结合实际应用场景确定了普通用户、专家用户、管理员三类角色需求，分析了功能和非功能需求，通过用例模型形式化描述了主要业务流程；然后提出了前后端分离、模型服务解耦的架构方案，将Vue3前端、Spring Boot后端、FastAPI模型服务和MySQL数据库有机结合起来，形成了层次清晰、耦合度低的系统整体框架。 - 在系统详细设计与实现阶段，重点围绕识别模型的设计、训练与部署进行了深入说明和开发。数据层面，基于 PlantVillage 数据集完成了数据清洗、划分和增强，为模型训练提供了高质量数据；模型层面，选取 MobileNetV2 作为轻量化骨干网络，通过迁移学习分别构建了物种识别模型和病害识别模型，并独立训练了叶片存在性二分类模型，形成了两阶段的识别架构；服务层面，使用 FastAPI 将训练好的模型封装为独立的推理服务，提供统一HTTP接口，后端通过配置项集成调用，实现了业务服务与模型服务的松耦合；同时实现了前端单页应用的各主要模块界面、后端业务逻辑和数据库表结构等，完整覆盖了系统所需的功能点。 - 在系统测试阶段，对系统进行了充分的功能性测试、识别模型评估和性能测试，结果表明系统基本达到了预期设计要求：功能流程正确完整、识别模型精度较高且两阶段策略有效减少了误判、系统在一定并发负载下运行稳定，响应性能良好。

总体来说，本课题实现了从数据预处理、模型训练、服务封装、前后端集成到测试评估的完整技术流程，搭建了一个可供实际试用的植物病害智能诊断与辅助决策平台，在功能实现和技术可行性方面达到了预期目标。

## 6.2 创新点与特点

本课题在系统设计和实现过程中有以下创新点和特点： 

1. 引入两阶段识别框架：区别于直接将所有图像输入病害识别模型的传统方案，本系统增加了叶片存在性二分类模型作为前置，把纯背景或无效图片拦截在主识别之前，通过普通阈值和严格阈值的分级策略，实现对疑似背景的预警提示和对明确背景的直接拦截。这种两阶段识别框架有效减少了背景类样本造成的误诊，提高了识别结果可靠性，在包含背景类别的农业病害数据集场景下具有一定创新性和泛用价值。 

2. 轻量级 MobileNetV2 双模型设计：本系统针对“物种识别”和“病害识别”任务分别训练了两个基于MobileNetV2的CNN模型，而非采用单一大型模型同时输出两个结果。这样做的好处是大幅降低了每个模型的参数规模和计算开销，使推理服务能够在资源有限的环境中快速响应，并支持更高的并发。同时，双模型架构允许对物种和病害任务分别优化和独立更新，灵活性更高。 

3. 识别诊断与知识、电商功能集成：系统在提供图像病害诊断的同时，围绕诊断结果集成了病害知识库查询和专家技术指导服务，使用户在获得识别结论的同时能学习相关病害的背景知识和科学防治措施。在此基础上又融合了农资商品展示与在线购买功能，形成了从“诊断→学习→指导→购买”的完整业务闭环。这种将AI诊断与知识普及、电商交易结合的模式为农业领域信息化服务提供了一种新思路。此外，系统通过聊天模块搭建了农户与专家实时交流的通道，加强了系统的互动性和服务能力。 

4. 模型服务与业务服务解耦部署：本系统采取了模型推理服务独立化的架构，将深度学习模型的推理从后端业务服务器中剥离出来，转由一个独立运行的FastAPI服务承载。后端仅通过HTTP接口与模型服务交互，不关心模型内部实现细节。这种设计降低了后端系统复杂度和潜在错误影响范围，让模型的独立部署、扩容或替换更加方便。例如，未来可以在不修改后端代码的前提下，将模型服务迁移至具有GPU加速的服务器或云端环境，或部署多个模型服务实例以负载均衡，提高系统整体的可扩展性和鲁棒性。

## 6.3 存在的不足

尽管本课题在系统功能和技术实现方面取得了一定进展，但由于时间、条件和经验等因素的限制，仍然存在一些不足之处，有待在后续工作中进一步改进和完善：

（1）数据集覆盖范围与实际生产场景存在差异。当前模型主要基于 PlantVillage 数据集进行训练和评估，该数据集多在相对理想和受控的环境下采集，图像背景较为简洁，光照和拍摄角度相对规范。而实际生产环境中的病害图像往往背景复杂、光照变化大、叶片被遮挡或重叠，摄像设备和操作习惯也存在较大差异。因此，当前模型在真实田间场景中的表现仍有待进一步验证和提升。

（2）模型在极端光照、遮挡情况下的鲁棒性不足。尽管在训练中采用了数据增强策略以提高模型对光照和视角变化的适应性，但在强烈逆光、严重阴影、叶片部分遮挡或多叶片重叠等极端情况下，模型仍可能出现误判或置信度偏低的情况。特别是病斑不典型或处于早期阶段时，模型对细微特征的捕捉能力仍有提升空间。

（3）系统部署与运维层面的限制。当前系统主要在单机环境下进行开发和测试，前端、后端、模型服务和数据库大多部署在同一物理环境或局域网中，尚未在大规模用户访问或复杂网络环境下进行长期运行验证。在监控、日志集中管理、自动化部署与扩容、故障恢复等运维层面，系统仍处于较为基础的状态，缺乏完善的运维体系支撑。

（4）缺乏对多样化终端和网络环境的深入适配。目前系统主要面向桌面浏览器访问，对移动端浏览器、小程序或离线场景的支持仍不充分。在网络带宽受限或网络不稳定的环境下，图片上传和识别服务的可用性与响应速度可能受到一定影响。

这些不足在一定程度上限制了系统在真实大规模生产场景中的直接应用，需要在后续研究与开发中逐步加以改进和优化。

## 6.4 后续工作展望

针对上述不足和未来发展的需要，本课题的后续工作可以从以下几个方向展开：

（1）扩展支持更多作物与病害类型。当前模型主要针对 PlantVillage 数据集中覆盖的作物和病害类型进行训练和评估，未来可在实际生产场景中进一步采集本地品种和主要病害的图像数据，扩充数据集类别范围，并根据新数据对模型进行再训练或增量学习，使系统能够支持更多作物和更丰富的病害类型，提升其在不同地区和种植模式下的适用性。

（2）引入多模态信息提升诊断准确率。实际病害诊断不仅依赖叶片图像，还与气象条件（土壤湿度、气温、降雨量等）、土壤养分状况、栽培管理措施等因素密切相关。未来可以考虑引入气象数据、土壤传感器数据和农事操作记录等多模态信息，构建融合图像与环境特征的综合诊断模型，以进一步提升诊断的准确性与稳定性。

（3）将系统移植到移动端或小程序，提升使用便捷度。目前系统主要以 Web 浏览器为访问入口，未来可在保持现有后端和模型服务的基础上，开发移动端应用或小程序前端，使用户能够通过手机在田间地头直接拍照识别，查看知识和技术指导内容，提升系统的易用性和普及程度。同时，可针对移动端网络环境的特点，对图片上传和结果展示进行优化。

（4）探索在线学习与持续训练机制，提升模型长期表现。随着系统在实际场景中的使用，系统将积累大量真实用户上传的病害图像和诊断结果。未来可以考虑设计在线学习或半自动标注机制，在专家审核和质量控制的前提下，将部分高质量样本纳入训练数据，周期性地对模型进行再训练或微调，实现模型能力的持续提升。此外，还可以引入模型版本管理和 A/B 测试机制，在保证服务稳定性的前提下验证新模型的效果。

（5）完善系统部署与运维体系。在系统推广应用的过程中，有必要引入容器化部署、自动化运维和集中监控等技术，对前端、后端、模型服务和数据库进行统一管理与监控。通过合理的日志收集与分析、性能监控和告警机制，可以及时发现和处理潜在问题，提高系统在复杂环境中的可用性和可靠性。

总之，本课题所构建的植物病害识别与辅助决策系统为后续研究和应用提供了一个可行的基础原型。随着更多真实数据的积累和新技术的不断发展，相信该系统在功能深度、识别精度和应用广度等方面都具备进一步提升的空间，为推动智慧农业和数字乡村建设提供有益的技术支撑。